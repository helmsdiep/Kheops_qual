//////////////////////////////////////////////////////////////////
// @file:
//   LG.Library.SAP.Conversions
// @description: 
//   create conversions based on the L906 lkp table definition
// @ownership: 
//   Ronan
//
/////////////////////////////////////////////////////////////////

// **********************************************************
// Enregistrement d'une conversion dans un tableau
// **********************************************************
function getConvArray(strMATNRP,strCounter,strUOM,strDenominator,strGrossWeight,strLengthOrDepth,strWidth,strThicknessOrHeight,strGTIN,strEANCategory,strNetWeight,strVolume,strMulti) {
	var arrayTemp=[];
	arrayTemp["UMREZ"]=strCounter;
	arrayTemp["MEINH"]=strUOM;
	arrayTemp["UMREN"]=strDenominator;
	//
	var strGrossNetWeightUnit="KG";
	var strVolumeUnit="M3";
	var strDimensionsUnit="MM";
	//
	strThicknessOrHeight=checkString(strThicknessOrHeight,"");
	strWidth=checkString(strWidth,"");
	strLengthOrDepth=checkString(strLengthOrDepth,"");
	strNetWeight=checkString(strNetWeight,"");
	strGrossWeight=checkString(strGrossWeight,"");
	strGrossNetWeightUnit=checkString(strGrossNetWeightUnit,"");
	strVolume=checkString(strVolume,"");
	strVolumeUnit=checkString(strVolumeUnit,"");
	strGTIN=checkString(strGTIN,"");
	strEANCategory=checkString(strEANCategory,"");
	strDimensionsUnit=checkString(strDimensionsUnit,"");
	//
	var dCounter = checkDouble(strCounter,0.0);
	var dMulti = checkDouble(strMulti,0.0);
	if(strCounter>0) {
		strVolume=formatNumberByPrecision((checkDouble(strVolume,0.0)*dMulti)/dCounter, 4);
		strGrossWeight=formatNumberByPrecision((checkDouble(strGrossWeight,0.0)*dMulti)/dCounter, 3);
		strNetWeight=formatNumberByPrecision((checkDouble(strNetWeight,0.0)*dMulti)/dCounter, 3);
	}
	//
	arrayTemp["ThicknessOrHeight"]=strThicknessOrHeight;
	arrayTemp["Width"]=strWidth;
	arrayTemp["LengthOrDepth"]=strLengthOrDepth;
	arrayTemp["NetWeight"]=strNetWeight;
	arrayTemp["GrossWeight"]=strGrossWeight;
	arrayTemp["GrossNetWeightUnit"]=strGrossNetWeightUnit;
	arrayTemp["GrossVolume"]=strVolume;
	arrayTemp["GrossVolumeUnit"]=strVolumeUnit;
	arrayTemp["GTIN"]=strGTIN;
	arrayTemp["EANCategory"]=strEANCategory;
	arrayTemp["DimensionsUnit"]=strDimensionsUnit;
	//
	return arrayTemp;
}

function sortUnits(arrayUnits) {
	var arrayUnitsSorted = [];
	var bUnitKG=false;
	var bUnitM=false;
	for(var i=0;i<arrayUnits.size();i++) {
		if(arrayUnits[i]=="KG") {
			bUnitKG=true;
		}
		else if(arrayUnits[i]=="M") {
			bUnitM=true;
		}
		else {
			arrayUnitsSorted.add(arrayUnits[i]);
		}
	}
	if(bUnitKG==true) {
		arrayUnitsSorted.add("KG");
	}
	if(bUnitM==true) {
		arrayUnitsSorted.add("M");
	}
	//
	return arrayUnitsSorted;
}

// ***************************
// Generate SAP target Code
// ***************************
function getMATNRSAPCode(oCurrentItem,strItemType) {
	var strMATNR = "";
	// MATNR management
	var strItemNumber = "";
	var strItemPackingCode = "";
	//
	if(strItemType=="Prod") {
		var strItemERPCode = oCurrentItem.getPrimaryKey();
		strMATNR = concat("SF_PH_",strItemERPCode);
	}
	else {
		var oItemNumberEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oCurrentItem,"01AC0045-ItemNumber");
		if(oItemNumberEn!=null) {
			strItemNumber = oItemNumberEn[0].getEntryNodeValue();
		}
		var oItemPackingCodeEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oCurrentItem,"01AC0046-ItemPackingCode");
		if(oItemPackingCodeEn!=null) {
			var strItemPackingCodeTemp = oItemPackingCodeEn[0].getEntryNodeValue();
			strItemPackingCodeTemp = checkString(strItemPackingCodeTemp,"");
			if (strItemPackingCodeTemp!="") {
				var oLkpItemPackingCodeBD400 = getCtgByName("L045-Condit.article BD400 - Item packing code in BD400");
				var oItemPackingCodeBD400 = oLkpItemPackingCodeBD400.getEntryByPrimaryKey(strItemPackingCodeTemp);
				if (oItemPackingCodeBD400!=null) {
					strItemPackingCode = oItemPackingCodeBD400.getEntryAttrib("SL045-Item_packing_code_in_BD400/C01-Code");
				}
			}
		}
		var oItemNumberJDEEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oCurrentItem,"01AC0649-ItemNumberJDE");
		if(oItemNumberJDEEn!=null) {
			var strItemNumberJDE = oItemNumberJDEEn[0].getEntryNodeValue();
			strItemNumberJDE = checkString(strItemNumberJDE,"");
			if (strItemNumberJDE!="") {
				strMATNR = concat("SF_",strItemNumberJDE);
			}
			else {
				strMATNR = concat("SF_",strItemNumber,strItemPackingCode);
			}
		}
		else {
			strMATNR = concat("SF_",strItemNumber,strItemPackingCode);
		}
	}
	//
	return strMATNR;
}

// ***************************
// ReformatDoubleCustomForDoubleField
// ***************************
function reformatDoubleCustomForDoubleField(dValue){
	var strValue = "";
	if(dValue>0) {
		strValue = reformatDouble(dValue,1,7);
		if (strValue!=null && strValue!="") {
			var iValueLen = strValue.length();
			strValue = concat(strValue,"|");
			for(var k=0;k<iValueLen;k++) {
				strValue=replaceString(strValue,"0|","|");
			}
		strValue=replaceString(strValue,"|","");
		}
		var iValueLen2 = (strValue.length()-1);
		var sep2 = checkInt(strValue.indexOf("."),0);
		if(iValueLen2==sep2) {
			strValue = substring(strValue,0,sep2);
		}
	}
return strValue;
}

// ***************************
// RemoveValueFromArray
// ***************************
function removeValueFromArray(aArray,strValue) {
	var aArray2 = [];
	strValue = checkString(strValue,"");
	//
	if(aArray!=null) {
		for(var i=0;i<aArray.size();i++) {
			if(strValue!=null && strValue!="" && aArray[i]!=strValue) {
				aArray2.add(aArray[i]);
			}
		}
	}
return aArray2;
}

// ***************************
// Retrieve L210 code Using L195 Value
// ***************************
function retrieveL210codeUsingL195Value(strL195Value) {
	var strL210code="";
	if(strL195Value!=null && strL195Value!="") {
		var oL195Item = getCtgByName("L195-Type d emballage - Packing type").getEntryByPrimaryKey(strL195Value);
		if(oL195Item!=null) {
			var strL195SAPCode = oL195Item.getEntryAttrib("SL195-Packing_type/C06-SAP Code");
			if(strL195SAPCode!=null && strL195SAPCode!="") {
				// Retrieve BaseUnitOfMesure code from L210
				var oL210Lkp = getCtgByName("L210-Unités normées - normalized units");
				var oL210LkpItemSet = oL210Lkp.getItemSetForCatalog();
				forEachItemSetElement(oL210LkpItemSet,oL210LkpItem) {
					var strSAPCode = oL210LkpItem.getEntryAttrib("SL210-normalized_units/C05-Code SAP");
					if(strSAPCode==strL195SAPCode) {
						strL210code=oL210LkpItem.getEntryAttrib("SL210-normalized_units/C00-DisplayName");
					}
				}
			}
		}
	}
	return strL210code;
}

// ***************************
// Round Num
// ***************************
function roundNum(invalue, idiv) {
	var resvalue=0;
	var dvalue = toDouble(invalue);
	var ddivvalue = dvalue/idiv;
	var idivvalue = toInteger(ddivvalue);
	var dtempvalue = toDouble(idivvalue);
	var ddifvalue = ddivvalue-dtempvalue;
	if(ddifvalue<=0.5) {
		resvalue=idivvalue;
	}
	else {
		resvalue=(idivvalue+1);
	}
	return resvalue;
}

// ***************************
// Retrieve all Unit types
// ***************************
function retrieveUnitValue(dUnitValue,iNumberofPackagedItems) {
	var aUnitValue = [];
	//
	if (dUnitValue!=null && dUnitValue>0) {
		var dUnitValue = dUnitValue*iNumberofPackagedItems;
		var strUnitValue = reformatDouble(dUnitValue,1,6);
		if (strUnitValue!=null && strUnitValue!="") {
			var iUnitValueLen = strUnitValue.length();
			strUnitValue = concat(strUnitValue,"|");
			for(var k=0;k<iUnitValueLen;k++) {
			 strUnitValue=replaceString(strUnitValue,"0|","|");
			}
			strUnitValue=replaceString(strUnitValue,"|","");
		}
		//
		var iUnitValueLen2 = strUnitValue.length();
		var sep2 = checkInt(strUnitValue.indexOf("."),0);
		var multiNumber2;
		if (sep2>-1) {
			var multi2 = (iUnitValueLen2-sep2)-1;
			multiNumber2 = 1;
			for(var k=0;k<multi2;k++) {
				multiNumber2=multiNumber2*10;
			}
		}
		else {
			multiNumber2=1;
		}
		// multi2 = facture multiplicatif afin d'obtenir une valeur entière
		var strUnitValueConv = checkInt(strUnitValue.replaceString(".",""),0);
		var iCoefMult2 = multiNumber2 * iNumberofPackagedItems;
		//
		var digits = "0";
		var digitsType = "";
		var icoefcorrec=1;
		if(iCoefMult2>99999) {
			digitsType="UMREZ";
			if(iCoefMult2<999999) {
				icoefcorrec=10;
				digits="10";
			}
			else if(iCoefMult2<9999999) {
				icoefcorrec=100;
				digits="100";
			}
			else if(iCoefMult2<99999999) {
				icoefcorrec=1000;
				digits="1000";
			}
			else if(iCoefMult2<999999999) {
				icoefcorrec=10000;
				digits="10000";
			}
			iCoefMult2=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(iCoefMult2,icoefcorrec);
			strUnitValueConv=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strUnitValueConv,icoefcorrec);
		}
		if(strUnitValueConv>99999) {
			digitsType="UMREN";
			if(strUnitValueConv<999999) {
				icoefcorrec=10;
				digits="10";
			}
			else if(strUnitValueConv<9999999) {
				icoefcorrec=100;
				digits="100";
			}
			else if(strUnitValueConv<99999999) {
				icoefcorrec=1000;
				digits="1000";
			}
			else if(strUnitValueConv<999999999) {
				icoefcorrec=10000;
				digits="10000";
			}
			iCoefMult2=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(iCoefMult2,icoefcorrec);
			strUnitValueConv=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strUnitValueConv,icoefcorrec);
		}
		//
		var iMulti=0;
		if(iNumberofPackagedItems>0) {
			iMulti=iCoefMult2/iNumberofPackagedItems;
		}
		//
		aUnitValue["UnitValueConv"]=strUnitValueConv;
		aUnitValue["Coef"]=iCoefMult2;
		aUnitValue["Multi"]=iMulti;
		aUnitValue["Digits"]=digits;
		aUnitValue["DigitsType"]=digitsType;
	}
	return aUnitValue;
}

function retrieveUnitValueForProd(dUnitValue,iNumberofPackagedItems) {
	var aUnitValue = [];
	//
	if (dUnitValue!=null && dUnitValue>0) {
		var dUnitValue = dUnitValue*iNumberofPackagedItems;
		var strUnitValue = reformatDouble(dUnitValue,1,4);
		if (strUnitValue!=null && strUnitValue!="") {
			var iUnitValueLen = strUnitValue.length();
			strUnitValue = concat(strUnitValue,"|");
			for(var k=0;k<iUnitValueLen;k++) {
			 strUnitValue=replaceString(strUnitValue,"0|","|");
			}
			strUnitValue=replaceString(strUnitValue,"|","");
		}
		//
		var iUnitValueLen2 = strUnitValue.length();
		var sep2 = checkInt(strUnitValue.indexOf("."),0);
		var multiNumber2;
		if (sep2>-1) {
			var multi2 = (iUnitValueLen2-sep2)-1;
			multiNumber2 = 1;
			for(var k=0;k<multi2;k++) {
				multiNumber2=multiNumber2*10;
			}
		}
		else {
			multiNumber2=1;
		}
		// multi2 = facture multiplicatif afin d'obtenir une valeur entière
		var strUnitValueConv = checkInt(strUnitValue.replaceString(".",""),0);
		var iCoefMult2 = multiNumber2 * iNumberofPackagedItems;
		//
		var icoefcorrec=1;
		if(iCoefMult2>99999) {
			if(iCoefMult2<999999) {
				icoefcorrec=10;
			}
			else if(iCoefMult2<9999999) {
				icoefcorrec=100;
			}
			else if(iCoefMult2<99999999) {
				icoefcorrec=1000;
			}
			else if(iCoefMult2<999999999) {
				icoefcorrec=10000;
			}
			iCoefMult2=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(iCoefMult2,icoefcorrec);
			strUnitValueConv=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strUnitValueConv,icoefcorrec);
		}
		if(strUnitValueConv>99999) {
			if(strUnitValueConv<999999) {
				icoefcorrec=10;
			}
			else if(strUnitValueConv<9999999) {
				icoefcorrec=100;
			}
			else if(strUnitValueConv<99999999) {
				icoefcorrec=1000;
			}
			else if(strUnitValueConv<999999999) {
				icoefcorrec=10000;
			}
			iCoefMult2=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(iCoefMult2,icoefcorrec);
			strUnitValueConv=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strUnitValueConv,icoefcorrec);
		}
		//
		var iMulti=0;
		if(iNumberofPackagedItems>0) {
			iMulti=iCoefMult2/iNumberofPackagedItems;
		}
		//
		aUnitValue["UnitValueConv"]=strUnitValueConv;
		aUnitValue["Coef"]=iCoefMult2;
		aUnitValue["Multi"]=iMulti;
	}
	return aUnitValue;
}

function retrieveUnitValueForPItem(dUnitValue,iNumberofPackagedItems) {
	var aUnitValue = [];
	//
	if (dUnitValue!=null && dUnitValue>0) {
		var dUnitValue = dUnitValue;
		var strUnitValue = reformatDouble(dUnitValue,1,6);
		if (strUnitValue!=null && strUnitValue!="") {
			var iUnitValueLen = strUnitValue.length();
			strUnitValue = concat(strUnitValue,"|");
			for(var k=0;k<iUnitValueLen;k++) {
			 strUnitValue=replaceString(strUnitValue,"0|","|");
			}
			strUnitValue=replaceString(strUnitValue,"|","");
		}
		//
		var iUnitValueLen2 = strUnitValue.length();
		var sep2 = checkInt(strUnitValue.indexOf("."),0);
		var multiNumber2;
		if (sep2>-1) {
			var multi2 = (iUnitValueLen2-sep2)-1;
			multiNumber2 = 1;
			for(var k=0;k<multi2;k++) {
				multiNumber2=multiNumber2*10;
			}
		}
		else {
			multiNumber2=1;
		}
		// multi2 = facture multiplicatif afin d'obtenir une valeur entière
		var strUnitValueConv = checkInt(strUnitValue.replaceString(".",""),0);
		var iCoefMult2 = multiNumber2 * iNumberofPackagedItems;
		//
		var icoefcorrec=1;
		var digits = "0";
		var digitsType = "";
		if(iCoefMult2>99999) {
			digitsType="UMREZ";
			if(iCoefMult2<999999) {
				icoefcorrec=10;
				digits="10";
			}
			else if(iCoefMult2<9999999) {
				icoefcorrec=100;
				digits="100";
			}
			else if(iCoefMult2<99999999) {
				icoefcorrec=1000;
				digits="1000";
			}
			else if(iCoefMult2<999999999) {
				icoefcorrec=10000;
				digits="10000";
			}
			iCoefMult2=getScriptByPath("/scripts/reports/LG.Report.SAP.Conversions").getFunctionByName("roundNum").invoke(iCoefMult2,icoefcorrec);
			strUnitValueConv=getScriptByPath("/scripts/reports/LG.Report.SAP.Conversions").getFunctionByName("roundNum").invoke(strUnitValueConv,icoefcorrec);
		}
		if(strUnitValueConv>99999) {
			digitsType="UMREN";
			if(strUnitValueConv<999999) {
				icoefcorrec=10;
				digits="10";
			}
			else if(strUnitValueConv<9999999) {
				icoefcorrec=100;
				digits="100";
			}
			else if(strUnitValueConv<99999999) {
				icoefcorrec=1000;
				digits="1000";
			}
			else if(strUnitValueConv<999999999) {
				icoefcorrec=10000;
				digits="10000";
			}
			iCoefMult2=getScriptByPath("/scripts/reports/LG.Report.SAP.Conversions").getFunctionByName("roundNum").invoke(iCoefMult2,icoefcorrec);
			strUnitValueConv=getScriptByPath("/scripts/reports/LG.Report.SAP.Conversions").getFunctionByName("roundNum").invoke(strUnitValueConv,icoefcorrec);
		}
		//
		var iMulti=0;
		if(iNumberofPackagedItems>0) {
			iMulti=iCoefMult2/iNumberofPackagedItems;
		}
		//
		aUnitValue["UnitValueConv"]=strUnitValueConv;
		aUnitValue["Coef"]=iCoefMult2;
		aUnitValue["Multi"]=iMulti;
		aUnitValue["Digits"]=digits;
		aUnitValue["DigitsType"]=digitsType;
	}
	return aUnitValue;
}

// 
function getBaseUnitAttrNameFromL906(strCatalogCode,strItemType,oItem,hmGlobals) {
	var oLkpSAPConversions = getCtgByName("L906-SAPConversionsMassUpdate");
	var strProdErpCode = "";
	var oProdItem = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getParentItem").invoke(hmGlobals,oItem);
	if (oProdItem!=null) {
		strProdErpCode = oProdItem.getPrimaryKey();
	}
	var strLkpEntryPrimaryKeyWithProdERPCode = concat("[",strCatalogCode," - ",strItemType," - ",strProdErpCode,"]");
	//
	var oLkpEntry = null;
	oLkpEntry = oLkpSAPConversions.getEntryByPrimaryKey(strLkpEntryPrimaryKeyWithProdERPCode);
	if (oLkpEntry==null) {
		var strLkpEntryPrimaryKey = concat("[",strCatalogCode," - ",strItemType,"]");
		oLkpEntry = oLkpSAPConversions.getEntryByPrimaryKey(strLkpEntryPrimaryKey);
	}	
	
	var strUnitKheopsAttributeName = "";
	if(oLkpEntry==null) {
		strUnitKheopsAttributeName = "06DN0661-BaseUnitOfMeasure";
	}
	else {
		strUnitKheopsAttributeName = oLkpEntry.getEntryAttrib("SL906-SAPConversionsMassUpdate/C05-UnitKheopsAttribute");
	}
	var strUnitKheopsAttribute = "";
	var oUnitKheopsAttributeEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,strUnitKheopsAttributeName);
	if(oUnitKheopsAttributeEn!=null) {
		strUnitKheopsAttribute = oUnitKheopsAttributeEn[0].getEntryNodeValue();
	}
	//
	return strUnitKheopsAttribute;
}

// ************************************************************************
//	FONCTION QUI RETOURNE LE PARENT D'UN ITEM
// ************************************************************************
function getParentItem(hmGlobals,item){
	//On retourne l'objet item situé à l'adresse contenue dans la varible globale "PARENT_RELATIONSHIP_FIELD"
	return item.getItemUsingEntryRelationshipAttrib(hmGlobals["PARENT_RELATIONSHIP_FIELD"]);
}

// ************************************************************************
//	FONCTION QUI RETOURNE LES PARENTS-GRANDS PARENTS D'UN ITEM	(tous les ancètres de l'item)
// ************************************************************************
function getParentsItem(hmGlobals,item,hmParents){
	//Ajoute l'item/parent/grandparent à la hashmap de Parents (selon l'étape de récursivité sur la fonction)
	hmParents.add(item);
	//On appelle la fonction getParentItem décrite ci dessus et qui retourne le parent d'un item 
	//on stocke le résultat dans parent
	var parent = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getParentItem").invoke(getScriptByPath("/scripts/triggers/LG.Library.Const").getFunctionByName("getConst").invoke(),item);
	if(parent!=null) {//Si il y a un parent on effectue une récursivité avec comme argument parent (pour trouver les grand-parents)
		return(getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getParentsItem").invoke(hmGlobals,parent,hmParents));
	}
	else {//sinon on retourne hmParents
		return(hmParents);
	}
}

// ************************************************************************
// Récupération des différents coefficients à traiter depuis les attributs d'unités initialisés à la création de l'item
// ************************************************************************
function getUnitsFromCurrentItemType(strCatalogCode,strItemType,oItem,hmGlobals) {
	var oitemStorageUnit="";
	var oitemManagementUnit="";
	var oitemPurchaseUnit="";
	var oitemSalesUnit="";
	var oitemPricingUnit="";
	var oitemShippingUnit="";
	var oitemUnitOfIssue="";
	var oitemAdditionalUnit1="";
	var oitemAdditionalUnit2="";
	var oitemAdditionalUnit3="";
	var oitemAdditionalUnit4="";
	
	var oitemStorageUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0749-StorageUnit");
	if (oitemStorageUnitEn!=null) {
		oitemStorageUnit = checkString(oitemStorageUnitEn.getEntryNodeValue(),"");
	}
	var oitemManagementUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0755-ManagementUnit");
	if (oitemManagementUnitEn!=null) {
		oitemManagementUnit = checkString(oitemManagementUnitEn.getEntryNodeValue(),"");
	}
	var oitemPurchaseUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0674-PurchasingUnit");
	if (oitemPurchaseUnitEn!=null) {
		oitemPurchaseUnit = checkString(oitemPurchaseUnitEn.getEntryNodeValue(),"");
	}
	var oitemSalesUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0732-SalesUnit");
	if (oitemSalesUnitEn!=null) {
		oitemSalesUnit = checkString(oitemSalesUnitEn.getEntryNodeValue(),"");
	}
	var oitemPricingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0752-PricingUnit");
	if (oitemPricingUnitEn!=null) {
		oitemPricingUnit = checkString(oitemPricingUnitEn.getEntryNodeValue(),"");
	}	
	var oitemShippingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0744-ShippingUnit");
	if (oitemShippingUnitEn!=null) {
		oitemShippingUnit = checkString(oitemShippingUnitEn.getEntryNodeValue(),"");
	}		
	var oitemUnitOfIssueEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0702-UnitOfIssue");
	if (oitemUnitOfIssueEn!=null) {
		oitemUnitOfIssue = checkString(oitemUnitOfIssueEn.getEntryNodeValue(),"");
	}		
	var oitemAdditionalUnit1En = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0758-AdditionalUnit1");
	if (oitemAdditionalUnit1En!=null) {
		oitemAdditionalUnit1 = checkString(oitemAdditionalUnit1En.getEntryNodeValue(),"");
	}
	var oitemAdditionalUnit2En = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0761-AdditionalUnit2");
	if (oitemAdditionalUnit2En!=null) {
		oitemAdditionalUnit2 = checkString(oitemAdditionalUnit2En.getEntryNodeValue(),"");
	}
	var oitemAdditionalUnit3En = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0764-AdditionalUnit3");
	if (oitemAdditionalUnit3En!=null) {
		oitemAdditionalUnit3 = checkString(oitemAdditionalUnit3En.getEntryNodeValue(),"");
	}
	var oitemAdditionalUnit4En = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0808-AdditionalUnit4");
	if (oitemAdditionalUnit4En!=null) {
		oitemAdditionalUnit4 = checkString(oitemAdditionalUnit4En.getEntryNodeValue(),"");
	}
	//
	var unittypesTemp =[];
	//
	oitemStorageUnit=checkString(oitemStorageUnit,"");
	if(oitemStorageUnit=="[PACKAGING] - Packaging") {
		var oPackagingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
		if (oPackagingUnitEn!=null) {
			oitemStorageUnit = checkString(oPackagingUnitEn.getEntryNodeValue(),"");
			oitemStorageUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveL210codeUsingL195Value").invoke(oitemStorageUnit);
		}
	}
	
	oitemManagementUnit=checkString(oitemManagementUnit,"");
	if(oitemManagementUnit=="[PACKAGING] - Packaging") {
		var oPackagingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
		if (oPackagingUnitEn!=null) {
			oitemManagementUnit = checkString(oPackagingUnitEn.getEntryNodeValue(),"");
			oitemManagementUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveL210codeUsingL195Value").invoke(oitemManagementUnit);
		}
	}

	oitemPurchaseUnit=checkString(oitemPurchaseUnit,"");
	if(oitemPurchaseUnit=="[PACKAGING] - Packaging") {
		var oPackagingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
		if (oPackagingUnitEn!=null) {
			oitemPurchaseUnit = checkString(oPackagingUnitEn.getEntryNodeValue(),"");
			oitemPurchaseUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveL210codeUsingL195Value").invoke(oitemPurchaseUnit);
		}
	}	
	
	oitemSalesUnit=checkString(oitemSalesUnit,"");
	if(oitemSalesUnit=="[PACKAGING] - Packaging") {
		var oPackagingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
		if (oPackagingUnitEn!=null) {
			oitemSalesUnit = checkString(oPackagingUnitEn.getEntryNodeValue(),"");
			oitemSalesUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveL210codeUsingL195Value").invoke(oitemSalesUnit);
		}
	}
	
	oitemPricingUnit=checkString(oitemPricingUnit,"");
	if(oitemPricingUnit=="[PACKAGING] - Packaging") {
		var oPackagingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
		if (oPackagingUnitEn!=null) {
			oitemPricingUnit = checkString(oPackagingUnitEn.getEntryNodeValue(),"");
			oitemPricingUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveL210codeUsingL195Value").invoke(oitemPricingUnit);
		}
	}
	
	oitemShippingUnit=checkString(oitemShippingUnit,"");
	if(oitemShippingUnit=="[PACKAGING] - Packaging") {
		var oPackagingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
		if (oPackagingUnitEn!=null) {
			oitemShippingUnit = checkString(oPackagingUnitEn.getEntryNodeValue(),"");
			oitemShippingUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveL210codeUsingL195Value").invoke(oitemShippingUnit);
		}
	}

	oitemUnitOfIssue=checkString(oitemUnitOfIssue,"");
	if(oitemUnitOfIssue=="[PACKAGING] - Packaging") {
		var oPackagingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
		if (oPackagingUnitEn!=null) {
			oitemUnitOfIssue = checkString(oPackagingUnitEn.getEntryNodeValue(),"");
			oitemUnitOfIssue = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveL210codeUsingL195Value").invoke(oitemUnitOfIssue);
		}
	}
	
	oitemAdditionalUnit1=checkString(oitemAdditionalUnit1,"");
	if(oitemAdditionalUnit1=="[PACKAGING] - Packaging") {
		var oPackagingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
		if (oPackagingUnitEn!=null) {
			oitemAdditionalUnit1 = checkString(oPackagingUnitEn.getEntryNodeValue(),"");
			oitemAdditionalUnit1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveL210codeUsingL195Value").invoke(oitemAdditionalUnit1);
		}
	}
	
	oitemAdditionalUnit2=checkString(oitemAdditionalUnit2,"");
	if(oitemAdditionalUnit2=="[PACKAGING] - Packaging") {
		var oPackagingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
		if (oPackagingUnitEn!=null) {
			oitemAdditionalUnit2 = checkString(oPackagingUnitEn.getEntryNodeValue(),"");
			oitemAdditionalUnit2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveL210codeUsingL195Value").invoke(oitemAdditionalUnit2);
		}
	}
	
	oitemAdditionalUnit3=checkString(oitemAdditionalUnit3,"");
	if(oitemAdditionalUnit3=="[PACKAGING] - Packaging") {
		var oPackagingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
		if (oPackagingUnitEn!=null) {
			oitemAdditionalUnit3 = checkString(oPackagingUnitEn.getEntryNodeValue(),"");
			oitemAdditionalUnit3 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveL210codeUsingL195Value").invoke(oitemAdditionalUnit3);
		}
	}

	oitemAdditionalUnit4=checkString(oitemAdditionalUnit4,"");
	if(oitemAdditionalUnit4=="[PACKAGING] - Packaging") {
		var oPackagingUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
		if (oPackagingUnitEn!=null) {
			oitemAdditionalUnit4 = checkString(oPackagingUnitEn.getEntryNodeValue(),"");
			oitemAdditionalUnit4 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveL210codeUsingL195Value").invoke(oitemAdditionalUnit4);
		}
	}
	
	//
	if(oitemStorageUnit!="") {
		unittypesTemp.add(oitemStorageUnit);
	}
	if(oitemManagementUnit!="") {
		unittypesTemp.add(oitemManagementUnit);
	}	
	if(oitemPurchaseUnit!="") {
		unittypesTemp.add(oitemPurchaseUnit);
	}	
	if(oitemSalesUnit!="") {
		unittypesTemp.add(oitemSalesUnit);
	}			
	if(oitemPricingUnit!="") {
		unittypesTemp.add(oitemPricingUnit);
	}		
	if(oitemShippingUnit!="") {
		unittypesTemp.add(oitemShippingUnit);
	}	
	if(oitemUnitOfIssue!="") {
		unittypesTemp.add(oitemUnitOfIssue);
	}	
	if(oitemAdditionalUnit1!="") {
		unittypesTemp.add(oitemAdditionalUnit1);
	}	
	if(oitemAdditionalUnit2!="") {
		unittypesTemp.add(oitemAdditionalUnit2);
	}	
	if(oitemAdditionalUnit3!="") {
		unittypesTemp.add(oitemAdditionalUnit3);
	}
	if(oitemAdditionalUnit4!="") {
		unittypesTemp.add(oitemAdditionalUnit4);
	}
	//
	return unittypesTemp;
}

function deleteBaseUnitOfMesureFromUnitList(aUnitList,strBaseUnitOfMesure) {
	var aUnitListNew = [];
	if(aUnitList!=null) {
		var iUnitListSize = aUnitList.size();
		for(var i=0;i<iUnitListSize;i++) {
			var unittemp = aUnitList[i];
			if(unittemp!=strBaseUnitOfMesure) {
				aUnitListNew.add(unittemp);
			}
		}
	}
	return aUnitListNew;
}

// ************************************************************************
// Récupération de la surface pour l'item courant
// ************************************************************************
function getSurface(oItem) {
	var oItemPK = oItem.getPrimaryKey();
	var surfaceAllUnits=[];
	
	// Init des valeurs
	surfaceAllUnits["m2"]=0;
		
	// Surface
	var surface;
	var surfaceUnit;
	var surfaceDouble;
	var surfaceEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0105-SurfaceArea");
	var surfaceUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0106-SurfaceAreaUnits");
	if(surfaceEn!=null) {
		surfaceDouble = surfaceEn[0].getEntryNodeValue();
		if (surfaceDouble!=null && surfaceDouble>0) {
			if (surfaceUnitEn!=null) {
				surfaceUnit=surfaceUnitEn[0].getEntryNodeValue();
				surfaceUnit = checkString(surfaceUnit,"");
				//
				if (surfaceUnit=="[CMK] - Centimètre carré") {
					surfaceDouble = surfaceDouble * 10000;
				}
			}
			surfaceAllUnits["m2"]=surfaceDouble;
		}
	}
	else {
	    var parentBUnit = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getPublishingItemAtLevel").invoke(oItem,"BUnit");
	    var parentProd  = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getPublishingItemAtLevel").invoke(oItem,"Prod");
		//
		var o04CP0095WidthEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(parentBUnit,"04CP0095-Width");
		var o04CP0097WidthUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(parentBUnit,"04CP0097-WidthUnit");
		//
		var o04CP0103LengthEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(parentBUnit,"04CP0103-Length");
		var o04CP0104LengthUnitsEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(parentBUnit,"04CP0104-LengthUnits");
		//
		if(o04CP0095WidthEn==null) {
			o04CP0095WidthEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(parentProd,"04CP0095-Width");
			o04CP0097WidthUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(parentProd,"04CP0097-WidthUnit");		
		}
		//
		var largeurUnit;
		var largeurDouble;
		if(o04CP0095WidthEn!=null && o04CP0097WidthUnitEn!=null) {
			var largeurDoubleInit;
			// largeur en m
			var strlargeurTemp = checkString(o04CP0095WidthEn[0].getEntryNodeValue(),"0");
			largeurDouble = toDouble(strlargeurTemp);
			largeurDoubleInit = largeurDouble;
			if(o04CP0097WidthUnitEn!=null) {
				largeurUnit=o04CP0097WidthUnitEn[0].getEntryNodeValue();
				largeurUnit = checkString(largeurUnit,"");
				if (largeurUnit!="" && largeurUnit=="[CMT] - Centimètre") {
					if (largeurDouble!=null && largeurDouble>0) {
						largeurDouble = largeurDoubleInit / 100;
					}
				}
				else if (largeurUnit!="" && largeurUnit=="[MMT] - Millimètre") {
					if (largeurDouble!=null && largeurDouble>0) {
						largeurDouble = largeurDoubleInit / 1000;
					}
				}	
				else if (largeurUnit!="" && largeurUnit=="[HMT] - Hectomètre") {
					if (largeurDouble!=null && largeurDouble>0) {
						largeurDouble = largeurDoubleInit * 100;
					}
				}
			}
		}
		var longueurUnit;
		var longueurDouble;
		if(o04CP0103LengthEn!=null && o04CP0104LengthUnitsEn!=null) {
			var longueurDoubleInit;
			
			// longueur en m
			var strlongueurTemp = checkString(o04CP0103LengthEn[0].getEntryNodeValue(),"0");
			longueurDouble = toDouble(strlongueurTemp);
			longueurDoubleInit = longueurDouble;
			if(o04CP0104LengthUnitsEn!=null) {
				longueurUnit=o04CP0104LengthUnitsEn[0].getEntryNodeValue();
				longueurUnit = checkString(longueurUnit,"");
				if (longueurUnit!="" && longueurUnit=="[CMT] - Centimètre") {
					if (longueurDouble>0) {
						longueurDouble = longueurDoubleInit / 100;
					}
				}
				else if (longueurUnit!="" && longueurUnit=="[MMT] - Millimètre") {
					if (longueurDouble>0) {
						longueurDouble = longueurDoubleInit / 1000;
					}
				}	
				else if (longueurUnit!="" && longueurUnit=="[HMT] - Hectomètre") {
					if (longueurDouble>0) {
						longueurDouble = longueurDoubleInit * 100;
					}
				}
			}
		}
		if(largeurDouble!=null && largeurDouble>0 && longueurDouble!=null && longueurDouble>0) {
			surfaceDouble = largeurDouble*longueurDouble;
			surfaceAllUnits["m2"]=surfaceDouble;
		}
	}
return surfaceAllUnits;
}

// ************************************************************************
// Récupération des valeurs de volume pour l'item courant
// ************************************************************************
function getVolume(oItem) {
	var oItemPK = oItem.getPrimaryKey();

	var volumeAllUnits=[];

	// Init des valeurs
	volumeAllUnits["m3"]=0;
	volumeAllUnits["l"]=0;
	volumeAllUnits["ml"]=0;
	
	// Volume
	var volume;
	var volumeUnit;
	var volumeDouble;
	var volumeDoubleInit;
	var volumelitre;
	var volumeDoublelitre;
	var volumemillilitre;
	var volumeDoublemillilitre;
	var volumeEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0217-RoughVolume");
	var volumeUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0218-RoughVolumeUnit");
	if(volumeEn!=null) {
		var strvolumeTemp = checkString(volumeEn[0].getEntryNodeValue(),"0");
		volumeDouble = toDouble(strvolumeTemp);
		volumeDoubleInit = volumeDouble;
		if (volumeUnitEn!=null) {
			volumeUnit=volumeUnitEn[0].getEntryNodeValue();
			volumeUnit = checkString(volumeUnit,"");
			if (volumeUnit!="" && volumeUnit=="[LTR] - Litre") {
				if (volumeDouble>0) {
					volumeDouble = volumeDouble / 1000;
				}
			}
			else if (volumeUnit!="" && volumeUnit=="[MLT] - Millilitre") {
				if (volumeDouble>0) {
					volumeDouble = volumeDouble / 1000000;
				}
			}
		}
		//
		if (volumeDouble!=null) {
			volumeAllUnits["m3"]=volumeDouble;
			
			// volume en litre
			if (volumeDouble>0) {
				if (volumeUnit!=null && volumeUnit!="" && volumeUnit=="[LTR] - Litre") {
					volumeDoublelitre = volumeDoubleInit;
				}
				else if (volumeUnit!=null && volumeUnit!="" && volumeUnit=="[MLT] - Millilitre") {
					if (volumeDoubleInit>0) {
						volumeDoublelitre = volumeDoubleInit/1000;
					}
				}
				else {
					volumeDoublelitre = volumeDouble*1000;
				}
				volumeAllUnits["l"]=volumeDoublelitre;
			}
			// volume en millilitre
			if (volumeDouble>0) {
				if (volumeUnit!=null && volumeUnit!="" && volumeUnit=="[LTR] - Litre") {
					volumeDoublemillilitre = volumeDoubleInit*1000;
				}
				else if (volumeUnit!=null && volumeUnit!="" && volumeUnit=="[MLT] - Millilitre") {
					volumeDoublemillilitre = volumeDoubleInit;
				}
				else {
					volumeDoublemillilitre = volumeDouble*1000000;
				}
				volumeAllUnits["ml"]=volumeDoublemillilitre;
			}
		}
	}
return volumeAllUnits;
}

// ************************************************************************
// Récupération des valeurs de longueur pour l'item PItem
// ************************************************************************
function getLongueurPItem(oItem) {
	var oItemPK = oItem.getPrimaryKey();
	
	var longueurAllUnits = [];
	
	// Init des valeurs
	longueurAllUnits["m"]=0;
	longueurAllUnits["hm"]=0;
	longueurAllUnits["mm"]=0;
	
	// Longueur en m et hecto mètre
	var longueur;
	var longueurUnit;
	var longueurDouble;
	var longueurDoubleInit;
	var longueurhectom;
	var longueurDoublehectom;
	var longueurmillim;
	var longueurDoublemillim;
	var longueurEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0116-Depth");
	var longueurUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0117-DepthUnits");
	if(longueurEn!=null) {
		// longueur en m
		var strlongueurTemp = checkString(longueurEn[0].getEntryNodeValue(),"0");
		longueurDouble = toDouble(strlongueurTemp);
		longueurDoubleInit = longueurDouble;
		if(longueurUnitEn!=null) {
			longueurUnit=longueurUnitEn[0].getEntryNodeValue();
			longueurUnit = checkString(longueurUnit,"");
			if (longueurUnit!="" && longueurUnit=="[CMT] - Centimètre") {
				if (longueurDouble!=null && longueurDouble>0) {
					longueurDouble = longueurDoubleInit / 100;
					longueurDoublemillim = longueurDoubleInit * 10;
					longueurDoublehectom = longueurDoubleInit / 10000;
				}
			}
			else if (longueurUnit!="" && longueurUnit=="[MMT] - Millimètre") {
				if (longueurDouble!=null && longueurDouble>0) {
					longueurDouble = longueurDoubleInit / 1000;
					longueurDoublemillim = longueurDoubleInit;
					longueurDoublehectom = longueurDoubleInit / 100000;
				}
			}	
			else if (longueurUnit!="" && longueurUnit=="[HMT] - Hectomètre") {
				if (longueurDouble!=null && longueurDouble>0) {
					longueurDouble = longueurDoubleInit * 100;
					longueurDoublemillim = longueurDoubleInit * 100000;
					longueurDoublehectom = longueurDoubleInit;
				}
			}
			else {
				if (longueurDouble!=null && longueurDouble>0) {
					longueurDoublemillim = longueurDoubleInit * 1000;
					longueurDoublehectom = longueurDoubleInit/100;
				}
			}
		}
		//
		if (longueurDouble!=null && longueurDouble>0) {
			longueurAllUnits["hm"]=longueurDoublehectom;
			longueurAllUnits["m"]=longueurDouble;
			longueurAllUnits["mm"]=longueurDoublemillim;
		}		
	}
return longueurAllUnits;
}

// ************************************************************************
// Récupération des valeurs de longueur pour l'item courant
// ************************************************************************
function getLongueur(oItem) {
	var oItemPK = oItem.getPrimaryKey();
	
	var longueurAllUnits = [];
	
	// Init des valeurs
	longueurAllUnits["m"]=0;
	longueurAllUnits["hm"]=0;
	longueurAllUnits["mm"]=0;
	
	// Longueur en m et hecto mètre
	var longueur;
	var longueurUnit;
	var longueurDouble;
	var longueurDoubleInit;
	var longueurhectom;
	var longueurDoublehectom;
	var longueurmillim;
	var longueurDoublemillim;
	var longueurEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0103-Length");
	var longueurUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0104-LengthUnits");
	if(longueurEn!=null) {
		// longueur en m
		var strlongueurTemp = checkString(longueurEn[0].getEntryNodeValue(),"0");
		longueurDouble = toDouble(strlongueurTemp);
		longueurDoubleInit = longueurDouble;
		if(longueurUnitEn!=null) {
			longueurUnit=longueurUnitEn[0].getEntryNodeValue();
			longueurUnit = checkString(longueurUnit,"");
			if (longueurUnit!="" && longueurUnit=="[CMT] - Centimètre") {
				if (longueurDouble>0) {
					longueurDouble = longueurDoubleInit / 100;
					longueurDoublemillim = longueurDoubleInit * 10;
					longueurDoublehectom = longueurDoubleInit / 10000;
				}
			}
			else if (longueurUnit!="" && longueurUnit=="[MMT] - Millimètre") {
				if (longueurDouble>0) {
					longueurDouble = longueurDoubleInit / 1000;
					longueurDoublemillim = longueurDoubleInit;
					longueurDoublehectom = longueurDoubleInit / 100000;
				}
			}	
			else if (longueurUnit!="" && longueurUnit=="[HMT] - Hectomètre") {
				if (longueurDouble>0) {
					longueurDouble = longueurDoubleInit * 100;
					longueurDoublemillim = longueurDoubleInit * 100000;
					longueurDoublehectom = longueurDoubleInit;
				}
			}
			else {
				if (longueurDouble>0) {
					longueurDoublemillim = longueurDoubleInit * 1000;
					longueurDoublehectom = longueurDoubleInit/100;
				}
			}
		}
		//
		if (longueurDouble!=null && longueurDouble>0) {
			longueurAllUnits["hm"]=longueurDoublehectom;
			longueurAllUnits["m"]=longueurDouble;
			longueurAllUnits["mm"]=longueurDoublemillim;
		}		
	}
return longueurAllUnits;
}

// ************************************************************************
// Récupération des valeurs de largeur du niveau BUnit
// ************************************************************************
function getLargeur(oItem) {
	var oItemPK = oItem.getPrimaryKey();
	
	var largeurAllUnits = [];
	
	// Init des valeurs
	largeurAllUnits["m"]=0;
	largeurAllUnits["hm"]=0;
	largeurAllUnits["mm"]=0;
	
	// largeur en m et hecto mètre
	var largeur;
	var largeurUnit;
	var largeurDouble;
	var largeurDoubleInit;
	var largeurhectom;
	var largeurDoublehectom;
	var largeurmillim;
	var largeurDoublemillim;
	var largeurEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0095-Width");
	var largeurUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0097-WidthUnit");
	if(largeurEn!=null) {
		// largeur en m
		var strlargeurTemp = checkString(largeurEn[0].getEntryNodeValue(),"0");
		largeurDouble = toDouble(strlargeurTemp);
		largeurDoubleInit = largeurDouble;
		if(largeurUnitEn!=null) {
			largeurUnit=largeurUnitEn[0].getEntryNodeValue();
			largeurUnit = checkString(largeurUnit,"");
			if (largeurUnit!="" && largeurUnit=="[CMT] - Centimètre") {
				if (largeurDouble>0) {
					largeurDouble = largeurDoubleInit / 100;
					largeurDoublemillim = largeurDoubleInit * 10;
					largeurDoublehectom = largeurDoubleInit / 10000;
				}
			}
			else if (largeurUnit!="" && largeurUnit=="[MMT] - Millimètre") {
				if (largeurDouble>0) {
					largeurDouble = largeurDoubleInit / 1000;
					largeurDoublemillim = largeurDoubleInit;
					largeurDoublehectom = largeurDoubleInit / 100000;
				}
			}	
			else if (largeurUnit!="" && largeurUnit=="[HMT] - Hectomètre") {
				if (largeurDouble>0) {
					largeurDouble = largeurDoubleInit * 100;
					largeurDoublemillim = largeurDoubleInit * 100000;
					largeurDoublehectom = largeurDoubleInit;
				}
			}
			else {
				if (largeurDouble>0) {
					largeurDoublemillim = largeurDoubleInit * 1000;
					largeurDoublehectom = largeurDoubleInit/100;
				}
			}
		}
		//
		if (largeurDouble!=null && largeurDouble>0) {
			largeurAllUnits["hm"]=largeurDoublehectom;
			largeurAllUnits["m"]=largeurDouble;
			largeurAllUnits["mm"]=largeurDoublemillim;
		}		
	}
return largeurAllUnits;
}

// ************************************************************************
// Récupération des valeurs de largeur du niveau PItem
// ************************************************************************
function getLargeurPItem(oItem) {
	var oItemPK = oItem.getPrimaryKey();
	
	var largeurAllUnits = [];
	
	// Init des valeurs
	largeurAllUnits["m"]=0;
	largeurAllUnits["hm"]=0;
	largeurAllUnits["mm"]=0;
	
	// largeur en m et hecto mètre
	var largeur;
	var largeurUnit;
	var largeurDouble;
	var largeurDoubleInit;
	var largeurhectom;
	var largeurDoublehectom;
	var largeurmillim;
	var largeurDoublemillim;
	var largeurEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0118-PItemWidth");
	var largeurUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0120-PItemWidthUnits");
	if(largeurEn!=null) {
		// largeur en m
		var strlargeurTemp = checkString(largeurEn[0].getEntryNodeValue(),"0");
		largeurDouble = toDouble(strlargeurTemp);
		largeurDoubleInit = largeurDouble;
		if(largeurUnitEn!=null) {
			largeurUnit=largeurUnitEn[0].getEntryNodeValue();
			largeurUnit = checkString(largeurUnit,"");
			if (largeurUnit!="" && largeurUnit=="[CMT] - Centimètre") {
				if (largeurDouble>0) {
					largeurDouble = largeurDoubleInit / 100;
					largeurDoublemillim = largeurDoubleInit * 10;
					largeurDoublehectom = largeurDoubleInit / 10000;
				}
			}
			else if (largeurUnit!="" && largeurUnit=="[MMT] - Millimètre") {
				if (largeurDouble>0) {
					largeurDouble = largeurDoubleInit / 1000;
					largeurDoublemillim = largeurDoubleInit;
					largeurDoublehectom = largeurDoubleInit / 100000;
				}
			}	
			else if (largeurUnit!="" && largeurUnit=="[HMT] - Hectomètre") {
				if (largeurDouble>0) {
					largeurDouble = largeurDoubleInit * 100;
					largeurDoublemillim = largeurDoubleInit * 100000;
					largeurDoublehectom = largeurDoubleInit;
				}
			}
			else {
				if (largeurDouble>0) {
					largeurDoublemillim = largeurDoubleInit * 1000;
					largeurDoublehectom = largeurDoubleInit/100;
				}
			}
		}
		//
		if (largeurDouble!=null  && largeurDouble>0) {
			largeurAllUnits["hm"]=largeurDoublehectom;
			largeurAllUnits["m"]=largeurDouble;
			largeurAllUnits["mm"]=largeurDoublemillim;
		}		
	}
return largeurAllUnits;
}

// ************************************************************************
// Récupération des valeurs de poids net pour l'item courant
// ************************************************************************
function getPoidsNet(oItem) {
	var oItemPK = oItem.getPrimaryKey();
	
	var poidsNetAllUnits = [];

	// Init des valeurs
	poidsNetAllUnits["kg"]=0;
	poidsNetAllUnits["to"]=0;
	poidsNetAllUnits["g"]=0;
	
	// *****************************
	// Poids en kg, tonne et gramme
	// netWeight
	// *****************************
	var poidsNet;
	var poidsNetUnit;
	var poidsNetDouble;
	var poidsNetDoubleInit;
	var poidsNettonne;
	var poidsNetDoubletonne;
	var poidsNetgramme;
	var poidsNetDoublegramme;
	var poidsNetEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0213-netWeight");
	var poidsNetUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0214-netWeightUnit");
	if(poidsNetEn!=null) {
		// poids en kg
		var strpoidsNetTemp = checkString(poidsNetEn[0].getEntryNodeValue(),"0");
		poidsNetDouble = toDouble(strpoidsNetTemp);
		poidsNetDoubleInit = poidsNetDouble;
		if (poidsNetUnitEn!=null) {
			poidsNetUnit=poidsNetUnitEn[0].getEntryNodeValue();
			poidsNetUnit = checkString(poidsNetUnit,"");
			if (poidsNetUnit!="" && poidsNetUnit=="[TNE] - Tonne") {
				if (poidsNetDouble>0) {
					poidsNetDouble = poidsNetDouble / 1000;
				}
			}
			else if (poidNetsUnit!="" && poidsNetUnit=="[GRM] - Gramme") {
				poidsNetDouble = poidsNetDouble * 1000;
			}	
		}
		if (poidsNetDouble!=null) {
			poidsNetAllUnits["kg"] = poidsNetDouble;
			
			// poids en tonne
			if (poidsNetDouble>0) {
				if (poidsNetUnit!=null && poidsNetUnit!="" && poidsNetUnit=="[TNE] - Tonne") {
					poidsNetDoubletonne = poidsNetDoubleInit;
				}
				else if (poidsNetUnit!=null && poidsNetUnit!="" && poidsNetUnit=="[GRM] - Gramme") {
					if (poidsNetDoubleInit>0) {
						poidsNetDoubletonne = poidsNetDoubleInit/1000000;
					}
				}
				else {
					poidsNetDoubletonne = poidsNetDouble/1000;
				}
				poidsNetAllUnits["to"] = poidsNetDoubletonne;
			}
			// poids en gramme
			if (poidsNetDouble>0) {
				if (poidsNetUnit!=null && poidsNetUnit!="" && poidsNetUnit=="[TNE] - Tonne") {
					poidsNetDoublegramme = poidsNetDoubleInit*1000000;
				}
				else if (poidsNetUnit!=null && poidsNetUnit!="" && poidsNetUnit=="[GRM] - Gramme") {
					poidsNetDoublegramme = poidsNetDoubleInit;
				}
				else {
					poidsNetDoublegramme = poidsNetDouble*1000;
				}
				poidsNetAllUnits["g"] = poidsNetDoublegramme;
			}
		}
	}
return poidsNetAllUnits;
}

// ************************************************************************
// Récupération des valeurs de poids brut pour l'item courant
// ************************************************************************
function getPoidsBrut(oItem) {
	var oItemPK = oItem.getPrimaryKey();
	
	var poidsBrutAllUnits = [];
	
	// Init des valeurs
	poidsBrutAllUnits["kg"]=0;
	poidsBrutAllUnits["to"]=0;
	poidsBrutAllUnits["g"]=0;
	
	// *****************************
	// Poids en kg, tonne et gramme
	// GrossWeight
	// *****************************
	var poids;
	var poidsUnit;
	var poidsDouble;
	var poidsDoubleInit;
	var poidstonne;
	var poidsDoubletonne;
	var poidsgramme;
	var poidsDoublegramme;
	var poidsEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0215-grossWeight");
	var poidsUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0216-grossWeightUnit");
	if(poidsEn!=null) {
		// poids en kg
		var strpoidsTemp = checkString(poidsEn[0].getEntryNodeValue(),"0");
		poidsDouble = toDouble(strpoidsTemp);
		poidsDoubleInit = poidsDouble;
		if (poidsUnitEn!=null) {
			poidsUnit=poidsUnitEn[0].getEntryNodeValue();
			poidsUnit = checkString(poidsUnit,"");
			if (poidsUnit!="" && poidsUnit=="[TNE] - Tonne") {
				if (poidsDouble>0) {
					poidsDouble = poidsDouble / 1000;
				}
			}
			else if (poidsUnit!="" && poidsUnit=="[GRM] - Gramme") {
				poidsDouble = poidsDouble * 1000;
			}	
		}
		if (poidsDouble!=null) {
			poidsBrutAllUnits["kg"]=poidsDouble;
			
			// poids en tonne
			if (poidsDouble>0) {
				if (poidsUnit!=null && poidsUnit!="" && poidsUnit=="[TNE] - Tonne") {
					poidsDoubletonne = poidsDoubleInit;
				}
				else if (poidsUnit!=null && poidsUnit!="" && poidsUnit=="[GRM] - Gramme") {
					if (poidsDoubleInit>0) {
						poidsDoubletonne = poidsDoubleInit/1000000;
					}
				}
				else {
					poidsDoubletonne = poidsDouble/1000;
				}
				poidsBrutAllUnits["to"]=poidsDoubletonne;
			}

			// poids en gramme
			if (poidsDouble>0) {
				if (poidsUnit!=null && poidsUnit!="" && poidsUnit=="[TNE] - Tonne") {
					poidsDoublegramme = poidsDoubleInit*1000000;
				}
				else if (poidsUnit!=null && poidsUnit!="" && poidsUnit=="[GRM] - Gramme") {
					poidsDoublegramme = poidsDoubleInit;
				}
				else {
					poidsDoublegramme = poidsDouble*1000;
				}
				poidsBrutAllUnits["g"]=poidsDoublegramme;
			}
		}
	}
return poidsBrutAllUnits;
}

// ************************************************************************
// Récupération des valeurs de poids brut issu de l'onglet Caractéristiques Physiques
// ************************************************************************
function getPoidsBrut04CP(oItem) {
	var oItemPK = oItem.getPrimaryKey();
	
	var poidsBrutAllUnits = [];
	
	// Init des valeurs
	poidsBrutAllUnits["kg"]=0;
	poidsBrutAllUnits["to"]=0;
	poidsBrutAllUnits["g"]=0;
	
	// *****************************
	// Poids en kg, tonne et gramme
	// GrossWeight
	// *****************************
	var poids;
	var poidsUnit;
	var poidsDouble;
	var poidsDoubleInit;
	var poidstonne;
	var poidsDoubletonne;
	var poidsgramme;
	var poidsDoublegramme;
	var poidsEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0215-grossWeight");
	var poidsUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0216-grossWeightUnit");
	if(poidsEn!=null) {
		// poids en kg
		var strpoidsTemp = checkString(poidsEn[0].getEntryNodeValue(),"0");
		poidsDouble = toDouble(strpoidsTemp);
		poidsDoubleInit = poidsDouble;
		if (poidsUnitEn!=null) {
			poidsUnit=poidsUnitEn[0].getEntryNodeValue();
			poidsUnit = checkString(poidsUnit,"");
			if (poidsUnit!="" && poidsUnit=="[TNE] - Tonne") {
				if (poidsDouble>0) {
					poidsDouble = poidsDouble / 1000;
				}
			}
			else if (poidsUnit!="" && poidsUnit=="[GRM] - Gramme") {
				poidsDouble = poidsDouble * 1000;
			}	
		}
		if (poidsDouble!=null) {
			poidsBrutAllUnits["kg"]=poidsDouble;
			
			// poids en tonne
			if (poidsDouble>0) {
				if (poidsUnit!=null && poidsUnit!="" && poidsUnit=="[TNE] - Tonne") {
					poidsDoubletonne = poidsDoubleInit;
				}
				else if (poidsUnit!=null && poidsUnit!="" && poidsUnit=="[GRM] - Gramme") {
					if (poidsDoubleInit>0) {
						poidsDoubletonne = poidsDoubleInit/1000000;
					}
				}
				else {
					poidsDoubletonne = poidsDouble/1000;
				}
				poidsBrutAllUnits["to"]=poidsDoubletonne;
			}

			// poids en gramme
			if (poidsDouble>0) {
				if (poidsUnit!=null && poidsUnit!="" && poidsUnit=="[TNE] - Tonne") {
					poidsDoublegramme = poidsDoubleInit*1000000;
				}
				else if (poidsUnit!=null && poidsUnit!="" && poidsUnit=="[GRM] - Gramme") {
					poidsDoublegramme = poidsDoubleInit;
				}
				else {
					poidsDoublegramme = poidsDouble*1000;
				}
				poidsBrutAllUnits["g"]=poidsDoublegramme;
			}
		}
	}
return poidsBrutAllUnits;
}

// ************************************************************************
// Récupération des valeurs de realThickness pour l'item courant
// ************************************************************************
function getRealThicknessProd(oItem) {
	var oItemPK = oItem.getPrimaryKey();
	
	var realThicknessAllUnits = [];
	
	// Init des valeurs
	realThicknessAllUnits["m"]=0;
	realThicknessAllUnits["hm"]=0;
	realThicknessAllUnits["mm"]=0;
	
	// realThickness en m et hecto mètre
	var realThickness;
	var realThicknessUnit;
	var realThicknessDouble;
	var realThicknessDoubleInit;
	var realThicknesshectom;
	var realThicknessDoublehectom;
	var realThicknessmillim;
	var realThicknessDoublemillim;
	var realThicknessEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0082-RealThickness");
	var realThicknessUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0084-RealThicknessUnits");
	if(realThicknessEn!=null) {
		// realThickness en m
		var strrealThicknessTemp = checkString(realThicknessEn[0].getEntryNodeValue(),"0");
		realThicknessDouble = toDouble(strrealThicknessTemp);
		realThicknessDoubleInit = realThicknessDouble;
		if(realThicknessUnitEn!=null) {
			realThicknessUnit=realThicknessUnitEn[0].getEntryNodeValue();
			realThicknessUnit = checkString(realThicknessUnit,"");
			if (realThicknessUnit!="" && realThicknessUnit=="[CMT] - Centimètre") {
				if (realThicknessDouble>0) {
					realThicknessDouble = realThicknessDoubleInit / 100;
					realThicknessDoublemillim = realThicknessDoubleInit * 10;
					realThicknessDoublehectom = realThicknessDoubleInit / 10000;
				}
			}
			else if (realThicknessUnit!="" && realThicknessUnit=="[MMT] - Millimètre") {
				if (realThicknessDouble>0) {
					realThicknessDouble = realThicknessDoubleInit / 1000;
					realThicknessDoublemillim = realThicknessDoubleInit;
					realThicknessDoublehectom = realThicknessDoubleInit / 100000;
				}
			}	
			else if (realThicknessUnit!="" && realThicknessUnit=="[HMT] - Hectomètre") {
				if (realThicknessDouble>0) {
					realThicknessDouble = realThicknessDoubleInit * 100;
					realThicknessDoublemillim = realThicknessDoubleInit * 100000;
					realThicknessDoublehectom = realThicknessDoubleInit;
				}
			}
			else {
				if (realThicknessDouble>0) {
					realThicknessDoublemillim = realThicknessDoubleInit * 1000;
					realThicknessDoublehectom = realThicknessDoubleInit/100;
				}
			}
		}
		//
		if (realThicknessDouble!=null && realThicknessDouble>0) {
			realThicknessAllUnits["hm"]=realThicknessDoublehectom;
			realThicknessAllUnits["m"]=realThicknessDouble;
			realThicknessAllUnits["mm"]=realThicknessDoublemillim;
		}		
	}
return realThicknessAllUnits;
}

// ************************************************************************
// Récupération des valeurs de thickness pour les BUnit
// ************************************************************************
function getThicknessBUnit(oItem) {
	var oItemPK = oItem.getPrimaryKey();
	
	var thicknessAllUnits = [];
	
	// Init des valeurs
	thicknessAllUnits["m"]=0;
	thicknessAllUnits["hm"]=0;
	thicknessAllUnits["mm"]=0;
	
	// thickness en m et hecto mètre
	var thickness;
	var thicknessUnit;
	var thicknessDouble;
	var thicknessDoubleInit;
	var thicknesshectom;
	var thicknessDoublehectom;
	var thicknessmillim;
	var thicknessDoublemillim;
	var thicknessEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0091-Thickness");
	var thicknessUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0092-ThicknessUnits");
	if(thicknessEn!=null) {
		// thickness en m
		var strthicknessTemp = checkString(thicknessEn[0].getEntryNodeValue(),"0");
		thicknessDouble = toDouble(strthicknessTemp);
		thicknessDoubleInit = thicknessDouble;
		if(thicknessUnitEn!=null) {
			thicknessUnit=thicknessUnitEn[0].getEntryNodeValue();
			thicknessUnit = checkString(thicknessUnit,"");
			if (thicknessUnit!="" && thicknessUnit=="[CMT] - Centimètre") {
				if (thicknessDouble>0) {
					thicknessDouble = thicknessDoubleInit / 100;
					thicknessDoublemillim = thicknessDoubleInit * 10;
					thicknessDoublehectom = thicknessDoubleInit / 10000;
				}
			}
			else if (thicknessUnit!="" && thicknessUnit=="[MMT] - Millimètre") {
				if (thicknessDouble>0) {
					thicknessDouble = thicknessDoubleInit / 1000;
					thicknessDoublemillim = thicknessDoubleInit;
					thicknessDoublehectom = thicknessDoubleInit / 100000;
				}
			}	
			else if (thicknessUnit!="" && thicknessUnit=="[HMT] - Hectomètre") {
				if (thicknessDouble>0) {
					thicknessDouble = thicknessDoubleInit * 100;
					thicknessDoublemillim = thicknessDoubleInit * 100000;
					thicknessDoublehectom = thicknessDoubleInit;
				}
			}
			else {
				if (thicknessDouble>0) {
					thicknessDoublemillim = thicknessDoubleInit * 1000;
					thicknessDoublehectom = thicknessDoubleInit/100;
				}
			}
		}
		//
		if (thicknessDouble!=null && thicknessDouble>0) {
			thicknessAllUnits["hm"]=thicknessDoublehectom;
			thicknessAllUnits["m"]=thicknessDouble;
			thicknessAllUnits["mm"]=thicknessDoublemillim;
		}		
	}
return thicknessAllUnits;
}

// ************************************************************************
// Récupération des valeurs de thickness pour les PItem
// ************************************************************************
function getThicknessPItem(oItem) {
	var oItemPK = oItem.getPrimaryKey();
	
	var thicknessAllUnits = [];
	
	// Init des valeurs
	thicknessAllUnits["m"]=0;
	thicknessAllUnits["hm"]=0;
	thicknessAllUnits["mm"]=0;
	
	// thickness en m et hecto mètre
	var thickness;
	var thicknessUnit;
	var thicknessDouble;
	var thicknessDoubleInit;
	var thicknesshectom;
	var thicknessDoublehectom;
	var thicknessmillim;
	var thicknessDoublemillim;
	
	var thicknessEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0114-Height");
	var thicknessUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0115-HeightUnits");
	if(thicknessEn!=null) {
		// thickness en m
		var strthicknessTemp = checkString(thicknessEn[0].getEntryNodeValue(),"0");
		thicknessDouble = toDouble(strthicknessTemp);
		thicknessDoubleInit = thicknessDouble;
		if(thicknessUnitEn!=null) {
			thicknessUnit=thicknessUnitEn[0].getEntryNodeValue();
			thicknessUnit = checkString(thicknessUnit,"");
			if (thicknessUnit!="" && thicknessUnit=="[CMT] - Centimètre") {
				if (thicknessDouble>0) {
					thicknessDouble = thicknessDoubleInit / 100;
					thicknessDoublemillim = thicknessDoubleInit * 10;
					thicknessDoublehectom = thicknessDoubleInit / 10000;
				}
			}
			else if (thicknessUnit!="" && thicknessUnit=="[MMT] - Millimètre") {
				if (thicknessDouble>0) {
					thicknessDouble = thicknessDoubleInit / 1000;
					thicknessDoublemillim = thicknessDoubleInit;
					thicknessDoublehectom = thicknessDoubleInit / 100000;
				}
			}	
			else if (thicknessUnit!="" && thicknessUnit=="[HMT] - Hectomètre") {
				if (thicknessDouble>0) {
					thicknessDouble = thicknessDoubleInit * 100;
					thicknessDoublemillim = thicknessDoubleInit * 100000;
					thicknessDoublehectom = thicknessDoubleInit;
				}
			}
			else {
				if (thicknessDouble>0) {
					thicknessDoublemillim = thicknessDoubleInit * 1000;
					thicknessDoublehectom = thicknessDoubleInit/100;
				}
			}
		}
		//
		if (thicknessDouble!=null && thicknessDouble>0) {
			thicknessAllUnits["hm"]=thicknessDoublehectom;
			thicknessAllUnits["m"]=thicknessDouble;
			thicknessAllUnits["mm"]=thicknessDoublemillim;
		}		
	}
return thicknessAllUnits;
}

function getEANCode(oItem,strTradeItemOrderable) {
	var strEANCode = "";
	var strCatalogCode = substring(oItem.getCatalog().getCtgName(),0,4);
	//
	if(strTradeItemOrderable!=null && strTradeItemOrderable=="true") {	
		var oEANCodeEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"01AC0042-GTIN");
		if(oEANCodeEn!=null) {
			strEANCode = checkString(oEANCodeEn[0].getEntryNodeValue(),"");
		}
	}
return strEANCode;
}

function getEANCategory(oItem,strEANCode) {
	var strEANCategory = "";
	//
	var oActiveEANCategoryArray = [];
	var oActiveEANCategoryLkpTable = getCtgByName("L912-ActiveEANCategory");
	var oL912EntrySet = oActiveEANCategoryLkpTable.getItemSetForCatalog();
	//
	for(var iPrefixLen=13;iPrefixLen>0;iPrefixLen--) {
		forEachItemSetElement(oL912EntrySet, oitemLkp) {
			var strattractiveeancategorycode = oitemLkp.getPrimaryKey();
			var strattractiveeancategoryprefix = checkString(oitemLkp.getEntryAttrib("SL912-ActiveEANCategory/C03-EANPrefix"),"");
			var iattractiveeancategoryprefixlen = strattractiveeancategoryprefix.length();
			if(iattractiveeancategoryprefixlen==iPrefixLen) {
				var strattractiveeancategorystatus = checkString(oitemLkp.getEntryAttrib("SL912-ActiveEANCategory/C04-Activated"),"");
				//
				if(strattractiveeancategorystatus==true) {
					oActiveEANCategoryArray.add(strattractiveeancategorycode);
				}
			}

		}
	}
	//
	if (strEANCode!=null && strEANCode!="") {
		if(strEANCode.length() > 8) {
			for (var i=0;i<oActiveEANCategoryArray.size();i++) {
				var strEANCatLine = oActiveEANCategoryArray[i];
				var oEANCat = strEANCatLine.parseDelim("-");
				var strLkpEANPrefix = oEANCat[0];
				var strLkpEANCategory = oEANCat[1];
				
				// out.writeln("--------------");
				// out.writeln("strLkpEANPrefix="+strLkpEANPrefix);
				// out.writeln("strLkpEANCategory="+strLkpEANCategory);
				// out.writeln("strEANCode="+strEANCode);
				
				if(strEANCode.startsWith(strLkpEANPrefix)) {
					strEANCategory = strLkpEANCategory;
				}
			}
		}
	}
	return strEANCategory;
}

// **********************************************************
// Traitement des Produits
// **********************************************************
function manageProdConversions(oItem,hmGlobals) {
	var aConvProd=[];
	//
	var strCatalogName = oItem.getCatalog().getCtgName();
	var strCatalogCode = "";
	if(substring(strCatalogName,0,2)=="CA") {
		strCatalogCode = concat("C",substring(strCatalogName,2,5));
	}
	else {
		strCatalogCode = substring(strCatalogName,0,4);
	}
	if(strCatalogCode=="C010") {	
		var oProdItemPK = oItem.getPrimaryKey();

		// MATNR management
		var strMATNRProd = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getMATNRSAPCode").invoke(oItem,"Prod");

		var strItemStatus = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getStatus").invoke(oItem);
		var strMaterialNumber="";
		var oMaterialNumberEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"01AC0664-MaterialNumber");
		if(oMaterialNumberEn!=null) {
			strMaterialNumber = checkString(oMaterialNumberEn.getEntryNodeValue(),"");
		}
		
		var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNRProd,"1","M2","1","","","","","","","","","1");
		aConvProd.add(aConvTemp);
		
		// Largeur
		var largeurArrayProd = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLargeur").invoke(oItem);
		var largeurDoubleProd = largeurArrayProd["m"];

		if(largeurDoubleProd!=null && largeurDoubleProd>0) {
			var dconvC44xM2 = ((1/largeurDoubleProd)*1000);
			
			var aM2Conv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForProd").invoke(dconvC44xM2,1);
			var strM2Conv = checkString(aM2Conv["UnitValueConv"],"");
			var iM2Coef = checkString(aM2Conv["Coef"],"");
			var iMulti = checkString(aM2Conv["Multi"],"");
			//
			if(strM2Conv!="" && iM2Coef!="") {
				var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNRProd,strM2Conv,"M",iM2Coef,"","","","","","","","",iMulti);
				aConvProd.add(aConvTemp);
			}
		}
	}
	return aConvProd;
}

// **********************************************************
// Traitement des BUnit
// **********************************************************
function manageBUnitConversions(oItem,hmGlobals) {
	var aConvBUnit=[];
	//
	// var log = getLogger("Lafarge.DataEntry");
	//
	var strCatalogName = oItem.getCatalog().getCtgName();
	strCatalogName = replace(strCatalogName,"CA","");
	strCatalogName = replace(strCatalogName,"C","");
	var strCatalogCode = concat("C",substring(strCatalogName,0,3));
	var oItemPK = oItem.getPrimaryKey();
	var strItemType = "Bunit";
	
	var strProdErpCode = "";
	var oProdItem = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getParentItem").invoke(hmGlobals,oItem);
	if (oProdItem!=null) {
		strProdErpCode = oProdItem.getPrimaryKey();
	}

	var bBUnitRelevance=false;
	var strBUnitSAPRelevanceLkpName="L907-BUnitSAPRelevance";
	var oBUnitSAPRelevanceLkp = getCtgByName(strBUnitSAPRelevanceLkpName);
	var oBUnitSAPRelevanceItem = oBUnitSAPRelevanceLkp.getEntryByPrimaryKey(strCatalogCode);
	if(oBUnitSAPRelevanceItem!=null) {
		bBUnitRelevance = oBUnitSAPRelevanceItem.getEntryAttrib("SL907-BUnitSAPRelevance/C02-Relevance");
	}

	var strTradeItemOrderable="";
	var oTradeItemOrderableEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"06DN0347-TradeItemOrderable");
	if(oTradeItemOrderableEn!=null) {
		strTradeItemOrderable = checkString(oTradeItemOrderableEn[0].getEntryNodeValue(),"");
	}

	var strItemStatus = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getStatus").invoke(oItem);
	var strMaterialNumber="";
	var oMaterialNumberEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"01AC0664-MaterialNumber");
	if(oMaterialNumberEn!=null) {
		strMaterialNumber = checkString(oMaterialNumberEn.getEntryNodeValue(),"");
	}
	var bInactiveItemToProcess="false";
	if(strItemStatus=="INACTIVE" && strMaterialNumber!="") {
		bInactiveItemToProcess="true";
	}

	var strMATNR = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getMATNRSAPCode").invoke(oItem,"BUnit");

	// SupportOfPacking
	var strSupportOfPacking = "";
	var strSupportOfPackingSAP = "";
	var oSupportOfPackingEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"06DN0399-SupportOfPacking");
	if (oSupportOfPackingEn!=null) {
		strSupportOfPacking = checkString(oSupportOfPackingEn.getEntryNodeValue(),"");
		if(strSupportOfPacking!="") {
			var lkp195 = getCtgByName("L195-Type d emballage - Packing type");
			var olkpitem = lkp195.getEntryByPrimaryKey(strSupportOfPacking);
			if(olkpitem!=null) {
				strSupportOfPackingSAP=olkpitem.getEntryAttrib("SL195-Packing_type/C06-SAP Code");
			}
		}
	}

	// Surface
	var surfaceArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getSurface").invoke(oItem);
	var surfaceDoubleBUnit = surfaceArrayBUnit["m2"];

	// Longueur
	var longueurArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLongueur").invoke(oItem);
	var longueurDoubleBUnit = longueurArrayBUnit["m"];
	var longueurDoublehectomBUnit= longueurArrayBUnit["hm"];
	var longueurDoublemillimBUnit= longueurArrayBUnit["mm"];

	// Largeur
	var largeurArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLargeur").invoke(oItem);
	var largeurDoubleBUnit = largeurArrayBUnit["m"];
	var largeurDoublehectomBUnit= largeurArrayBUnit["hm"];
	var largeurDoublemillimBUnit= largeurArrayBUnit["mm"];	

	// Largeur Prod
	var largeurArrayProd = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLargeur").invoke(oProdItem);
	var largeurDoubleProd = largeurArrayProd["m"];
	var largeurDoublehectomProd = largeurArrayProd["hm"];
	var largeurDoublemillimProd = largeurArrayProd["mm"];	

	var strLargeur;
	if(largeurDoublemillimBUnit!=null && largeurDoublemillimBUnit>0) {
		strLargeur = largeurDoublemillimBUnit;
	}
	if(largeurDoublemillimProd!=null && largeurDoublemillimProd>0) {
		strLargeur = largeurDoublemillimProd;
	}
	if(strLargeur==null) {
		strLargeur="";
	}

	// Volume
	var volumeArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getVolume").invoke(oItem);
	var volumeDoubleBUnit = volumeArrayBUnit["m3"];
	var volumeDoublelitreBUnit = volumeArrayBUnit["l"];
	var volumeDoublemillilitreBUnit = volumeArrayBUnit["ml"];

	// Poids net
	var poidsNetArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsNet").invoke(oItem);
	var poidsNetDoubleBUnit = poidsNetArrayBUnit["kg"];
	var poidsNetDoubletonneBUnit = poidsNetArrayBUnit["to"];
	var poidsNetDoublegrammeBUnit = poidsNetArrayBUnit["g"];

	// Poids brut
	var poidsBrutArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsBrut").invoke(oItem);
	var poidsDoubleBUnit = poidsBrutArrayBUnit["kg"];
	var poidsDoubletonneBUnit = poidsBrutArrayBUnit["to"];
	var poidsDoublegrammeBUnit = poidsBrutArrayBUnit["g"];

	// Poids brut caractéristiques physiques
	var poidsBrut04CPArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsBrut04CP").invoke(oItem);
	var poids04CPDoubleBUnit = poidsBrut04CPArrayBUnit["kg"];

	// RealThickness
	var oItemProd = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getParentItem").invoke(hmGlobals,oItem);
	var realThicknessProd = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getRealThicknessProd").invoke(oItemProd);
	var realThicknessDoubleProd = realThicknessProd["mm"];

	// Thickness
	var thicknessBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getThicknessBUnit").invoke(oItem);
	var thicknessDoubleBUnit = thicknessBUnit["mm"];

	var strThickness;
	if(realThicknessDoubleProd!=null && realThicknessDoubleProd>0) {
		strThickness = realThicknessDoubleProd;
	}
	if(thicknessDoubleBUnit!=null && thicknessDoubleBUnit>0) {
		strThickness = thicknessDoubleBUnit;
	}
	if(strThickness==null) {
		strThickness="";
	}
	
	var strUnitKheopsAttribute = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getBaseUnitAttrNameFromL906").invoke(strCatalogCode,strItemType,oItem,hmGlobals);

	// 06DN0661-BaseUnitOfMeasure
	var strBaseUnitOfMeasureSAP="";
	var strBaseUnitOfMeasure="";
	var oBaseUnitOfMeasureEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"06DN0661-BaseUnitOfMeasure");
	if(oBaseUnitOfMeasureEn!=null) {
		strBaseUnitOfMeasureSAP = checkString(oBaseUnitOfMeasureEn[0].getEntryNodeValue(),"");
		if(strBaseUnitOfMeasure!="") {
			// var iBaseUnitOfMeasureEndCode = strBaseUnitOfMeasure.indexOf("]");
			// strBaseUnitOfMeasureSAP = substring(strBaseUnitOfMeasure,1,iBaseUnitOfMeasureEndCode);
			strBaseUnitOfMeasureSAP = strBaseUnitOfMeasure;
		}
	}	

	// Retrieve BaseUnitOfMesure code from L210
	var strBaseUnitOfMeasureL210="";
	var oL210Lkp = getCtgByName("L210-Unités normées - normalized units");
	var oL210LkpItemSet = oL210Lkp.getItemSetForCatalog();
	forEachItemSetElement(oL210LkpItemSet,oL210LkpItem) {
		var strSAPCode = oL210LkpItem.getEntryAttrib("SL210-normalized_units/C05-Code SAP");
		if(strSAPCode==strBaseUnitOfMeasureSAP) {
			strBaseUnitOfMeasureL210=oL210LkpItem.getEntryAttrib("SL210-normalized_units/C00-DisplayName");
		}
	}

	var unittypesTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getUnitsFromCurrentItemType").invoke(strCatalogCode,strItemType,oItem,hmGlobals);
	
	// log.loggerDebug("Conversions BUnit - unittypesTemp="+unittypesTemp);
	
	if (unittypesTemp!=null) {
		var unittypes = getScriptByPath("/scripts/triggers/LG.Library.Utils").getFunctionByName("getDeduplicatedArray").invoke(unittypesTemp);
		
		log.loggerDebug("Conversions BUnit - unittypes 1="+unittypes);
		
		unittypes = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("deleteBaseUnitOfMesureFromUnitList").invoke(unittypes,strBaseUnitOfMeasureSAP);
		//
		log.loggerDebug("Conversions BUnit - unittypes 2="+unittypes);
		
		// 1 strBaseUnitOfMeasure = 1 strBaseUnitOfMeasure
		if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
			var strEANCode = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCode").invoke(oItem,strTradeItemOrderable);
			var strEANCategory = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCategory").invoke(oItem,strEANCode);
			var iMulti = "1";
			//
			// if(strBaseUnitOfMeasureSAP!=strSupportOfPackingSAP) {
				var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,strEANCode,strEANCategory,poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
				aConvBUnit.add(aConvTemp);
			// }
		}
		//
		log.loggerDebug("Conversions BUnit - unittypes="+unittypes);
		// Other conversions
		for (var j=0;j<unittypes.size(); j++) {		
			var strUnitType = unittypes[j];
			if (strUnitType=="M2") {
				// ******************************************************
				// Conversions M2-KG des catalogues C440 et 441
				// ******************************************************
				if (strUnitKheopsAttribute=="KG" && (strCatalogCode=="C440" || strCatalogCode=="C441")) {					
					var oProdItemC440C441 = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getParentItem").invoke(hmGlobals,oItem);
					if (oProdItemC440C441!=null) {
						var oPaperGrammageEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oProdItemC440C441,"04CP0156-PaperGrammage");
						if(oPaperGrammageEn!=null) {
							var strPaperGrammageTemp = checkString(oPaperGrammageEn[0].getEntryNodeValue(),"0");
							var dPaperGrammageTemp = toDouble(strPaperGrammageTemp);
							if(dPaperGrammageTemp>0) {
								dPaperGrammageTemp = dPaperGrammageTemp/1000;
								//
								var papergrammagetemp = reformatDouble(dPaperGrammageTemp,1,6);
								if (papergrammagetemp!=null && papergrammagetemp!="") {
									var papergrammagelengthInit = papergrammagetemp.length();
									papergrammagetemp = concat(papergrammagetemp,"|");
									for(var k=0;k<papergrammagelengthInit;k++) {
									 papergrammagetemp=replaceString(papergrammagetemp,"0|","|");
									}
									papergrammagetemp=replaceString(papergrammagetemp,"|","");
								}
								//
								if (papergrammagetemp!=null && papergrammagetemp!="") {
									var papergrammagetemplength = papergrammagetemp.length();
									var sep = checkInt(papergrammagetemp.indexOf("."),0);
									var multiNumber;
									if (sep>-1) {
										var multi = (papergrammagetemplength-sep)-1;
										multiNumber = 1;
										for(var k=0;k<multi;k++) {
											multiNumber=multiNumber*10;
										}
									}
									else {
										multiNumber=1;
									}
									// multi = facture multiplicatif afin d'obtenir une valeur entière
									var strPaperGrammageConv = checkInt(papergrammagetemp.replaceString(".",""),0);
									var iCoefMult = multiNumber;									
									//
									var icoefcorrec=1;
									if(iCoefMult>99999) {
										if(iCoefMult<999999) {
											icoefcorrec=10;
										}
										else if(iCoefMult<9999999) {
											icoefcorrec=100;
										}
										else if(iCoefMult<99999999) {
											icoefcorrec=1000;
										}
										else if(iCoefMult<999999999) {
											icoefcorrec=10000;
										}
										iCoefMult=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(iCoefMult,icoefcorrec);
										strPaperGrammageConv=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strPaperGrammageConv,icoefcorrec);
									}
									if(strPaperGrammageConv>99999) {
										if(strPaperGrammageConv<999999) {
											icoefcorrec=10;
										}
										else if(strPaperGrammageConv<9999999) {
											icoefcorrec=100;
										}
										else if(strPaperGrammageConv<99999999) {
											icoefcorrec=1000;
										}
										else if(strPaperGrammageConv<999999999) {
											icoefcorrec=10000;
										}
										iCoefMult=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(iCoefMult,icoefcorrec);
										strPaperGrammageConv=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strPaperGrammageConv,icoefcorrec);
									}
									//
									icoefcorrec=icoefcorrec*strPaperGrammageConv;
									//
									if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
										var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,iCoefMult,"M2",strPaperGrammageConv,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,strPaperGrammageConv);
										aConvBUnit.add(aConvTemp);
									}
								}
							}
						}
					}
				}
				// ******************************************************
				// Fin conversions M2-KG des catalogues C440 et 441
				// ******************************************************
				else {
					if (surfaceDoubleBUnit!=null && surfaceDoubleBUnit!="") {
						var aM2Conv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(surfaceDoubleBUnit,1);
						var strM2Conv = checkString(aM2Conv["UnitValueConv"],"");
						var iM2Coef = checkString(aM2Conv["Coef"],"");
						var iMulti = checkString(aM2Conv["Multi"],"");
						//
						if(strM2Conv!="" && iM2Coef!="") {
							if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strM2Conv,"M2",iM2Coef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvBUnit.add(aConvTemp);
							}
						}
					}
				}
			}
			else if (strUnitType=="M") {
				// ******************************************************
				// Conversions M-KG des catalogues C440 et 441
				// ******************************************************
				if (strUnitKheopsAttribute=="KG" && (strCatalogCode=="C440" || strCatalogCode=="C441")) {					
					var oProdItemC440C441 = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getParentItem").invoke(hmGlobals,oItem);
					if (oProdItemC440C441!=null) {
						var dPaperGrammageTemp;
						var oPaperGrammageEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oProdItemC440C441,"04CP0156-PaperGrammage");
						if(oPaperGrammageEn!=null) {
							var strPaperGrammageTemp = checkString(oPaperGrammageEn[0].getEntryNodeValue(),"0");
							dPaperGrammageTemp = toDouble(strPaperGrammageTemp);
						}
						var dWithTemp;
						var oWithEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0095-Width");
						if(oWithEn!=null) {
							var strWithTemp = checkString(oWithEn[0].getEntryNodeValue(),"0");
							dWithTemp = toDouble(strWithTemp);
						}
						if(dWithTemp!=null && dWithTemp>0 && dPaperGrammageTemp!=null && dPaperGrammageTemp>0) {
							var oWithUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0097-WidthUnit");
							if(oWithUnitEn!=null) {
								var strWithUnitTemp = checkString(oWithUnitEn[0].getEntryNodeValue(),"");
								if (strWithUnitTemp=="[MMT] - Millimètre") {
									dWithTemp = dWithTemp/1000;
								}
								else if (strWithUnitTemp=="[CMT] - Centimètre") {
									dWithTemp = dWithTemp/100;
								}
							}
							//
							var dconvC44xMeter = (dPaperGrammageTemp * dWithTemp)/1000;
							//
							if(dconvC44xMeter>0) {
								var convC44xMetertemp = reformatDouble(dconvC44xMeter,1,6);
								if (convC44xMetertemp!=null && convC44xMetertemp!="") {
									var convC44xMeterlengthInit = convC44xMetertemp.length();
									convC44xMetertemp = concat(convC44xMetertemp,"|");
									for(var k=0;k<convC44xMeterlengthInit;k++) {
									 convC44xMetertemp=replaceString(convC44xMetertemp,"0|","|");
									}
									convC44xMetertemp=replaceString(convC44xMetertemp,"|","");
									
								}
								//
								if (convC44xMetertemp!=null && convC44xMetertemp!="") {
									var convC44xMetertemplength = convC44xMetertemp.length();
									var sep = checkInt(convC44xMetertemp.indexOf("."),0);
									var multiNumber;
									if (sep>-1) {
										var multi = (convC44xMetertemplength-sep)-1;
										multiNumber = 1;
										for(var k=0;k<multi;k++) {
											multiNumber=multiNumber*10;
										}
									}
									else {
										multiNumber=1;
									}
									// multi = facture multiplicatif afin d'obtenir une valeur entière
									var strC44xMeterConv = checkInt(convC44xMetertemp.replaceString(".",""),0);
									var iCoefMult = multiNumber;
									//
									var icoefcorrec=1;
									if(iCoefMult>99999) {
										if(iCoefMult<999999) {
											icoefcorrec=10;
										}
										else if(iCoefMult<9999999) {
											icoefcorrec=100;
										}
										else if(iCoefMult<99999999) {
											icoefcorrec=1000;
										}
										else if(iCoefMult<999999999) {
											icoefcorrec=10000;
										}
										iCoefMult=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(iCoefMult,icoefcorrec);
										strC44xMeterConv=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strC44xMeterConv,icoefcorrec);
									}
									if(strC44xMeterConv>99999) {
										if(strC44xMeterConv<999999) {
											icoefcorrec=10;
										}
										else if(strC44xMeterConv<9999999) {
											icoefcorrec=100;
										}
										else if(strC44xMeterConv<99999999) {
											icoefcorrec=1000;
										}
										else if(strC44xMeterConv<999999999) {
											icoefcorrec=10000;
										}
										iCoefMult=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(iCoefMult,icoefcorrec);
										strC44xMeterConv=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strC44xMeterConv,icoefcorrec);
									}
									//
									icoefcorrec=icoefcorrec*strC44xMeterConv;
									//
									var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,iCoefMult,"M",strC44xMeterConv,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,strC44xMeterConv);
									aConvBUnit.add(aConvTemp);
								}
							}
						}
					}
				}
				// ******************************************************
				// Fin conversions M-KG des catalogues C440 et 441
				// ******************************************************
				else if (longueurDoubleBUnit!=null && longueurDoubleBUnit>0) {
					var aMConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(longueurDoubleBUnit,1);
					var strMConv = checkString(aMConv["UnitValueConv"],"");
					var iMCoef = checkString(aMConv["Coef"],"");
					var iMulti = checkString(aMConv["Multi"],"");
					//
					if(strMConv!="" && iMCoef!="") {
						if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
							var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strMConv,"M",iMCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
							aConvBUnit.add(aConvTemp);
						}
					}
				}
			}
			else if (strUnitType=="HM") {
				if (longueurDoublehectomBUnit!=null && longueurDoublehectomBUnit>0) {
					var aHMConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(longueurDoublehectomBUnit,1);
					var strHMConv = checkString(aHMConv["UnitValueConv"],"");
					var iHMCoef = checkString(aHMConv["Coef"],"");
					var iMulti = checkString(aHMConv["Multi"],"");
					//
					if(strHMConv!="" && iHMCoef!="") {
						if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
							var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strHMConv,"HM",iHMCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
							aConvBUnit.add(aConvTemp);
						}
					}
				}
			}
			else if (strUnitType=="KG") {
				if (strUnitKheopsAttribute=="TO") {
					if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
						var iMulti = "1";
						var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,"1000","KG","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
						aConvBUnit.add(aConvTemp);
					}
				} 
				else if (strUnitKheopsAttribute!="KG") {
					// ****************************
					// Ajout nouvelle règle de gestion (si le poids est dispo depuis l'attribut 04CP0213-netWeight ou l'attribut 06DN0360-GrossWeight
					// ****************************
					if (poidsNetDoubleBUnit!=null && poidsNetDoubleBUnit>0) {
						var aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsNetDoubleBUnit,1);
						var strKGConv = checkString(aKGConv["UnitValueConv"],"");
						var iKGCoef = checkString(aKGConv["Coef"],"");
						var iMulti = checkString(aKGConv["Multi"],"");
						//
						if(strKGConv!="" && iKGCoef!="") {
							if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strKGConv,"KG",iKGCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvBUnit.add(aConvTemp);
							}
						}
					}
					else if (poidsDoubleBUnit!=null && poidsDoubleBUnit>0) {
						var aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsDoubleBUnit,1);
						var strKGConv = checkString(aKGConv["UnitValueConv"],"");
						var iKGCoef = checkString(aKGConv["Coef"],"");
						var iMulti = checkString(aKGConv["Multi"],"");
						//
						if(strKGConv!="" && iKGCoef!="") {
							if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strKGConv,"KG",iKGCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvBUnit.add(aConvTemp);
							}
						}
					}
				}
			}
			else if (strUnitType=="TO") {
				// ******************************************************
				// Conversions Tonne des catalogues C440 et 441
				// ******************************************************
				if (strUnitKheopsAttribute=="KG" && (strCatalogCode=="C440" || strCatalogCode=="C441")) {
					var iNumberofPackagedItemsBUnit;
					var oNumberofPackagedItemsBUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"06DN0402-NumberOfPackagedItems");
					if(oNumberofPackagedItemsBUnitEn!=null) {
						iNumberofPackagedItemsBUnit = oNumberofPackagedItemsBUnitEn[0].getEntryNodeValue();
					}
				
					//
					// Poids en kg, tonne et gramme
					var poids;
					var poidsUnit;
					var poidsDouble;
					var poidsEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0215-grossWeight");
					var poidsUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"04CP0216-grossWeightUnit");
					if(poidsEn!=null) {
						// poids en tonne
						var strpoidsTemp = checkString(poidsEn[0].getEntryNodeValue(),"0");
						poidsDouble = toDouble(strpoidsTemp);
						if (poidsUnitEn!=null) {
							poidsUnit=poidsUnitEn[0].getEntryNodeValue();
							poidsUnit = checkString(poidsUnit,"");
							if (poidsUnit!="" && poidsUnit=="[TNE] - Tonne") {
								if (poidsDouble>0) {
									poidsDouble = poidsDouble / 1000;
								}
							}
							else if (poidsUnit!="" && poidsUnit=="[GRM] - Gramme") {
								poidsDouble = poidsDouble * 1000000;
							}	
						}
						if (poidsDouble != null && poidsDouble > 0 && iNumberofPackagedItemsBUnit != null && iNumberofPackagedItemsBUnit > 0) {
							var dConvBUnitKGTonneC44x = poidsDouble * iNumberofPackagedItemsBUnit;

							var strConvBUnitKGTonneC44x = reformatDouble(dConvBUnitKGTonneC44x,1,6);
							if (strConvBUnitKGTonneC44x!=null && strConvBUnitKGTonneC44x!="") {
								var convBUnitKGTonneC44xlengthInit = strConvBUnitKGTonneC44x.length();
								strConvBUnitKGTonneC44x = concat(strConvBUnitKGTonneC44x,"|");
								for(var k=0;k<convBUnitKGTonneC44xlengthInit;k++) {
								 strConvBUnitKGTonneC44x=replaceString(strConvBUnitKGTonneC44x,"0|","|");
								}
								strConvBUnitKGTonneC44x=replaceString(strConvBUnitKGTonneC44x,"|","");
							}
							//
							var strConvBUnitKGTonneC44xlength = strConvBUnitKGTonneC44x.length();
							var sep = checkInt(strConvBUnitKGTonneC44x.indexOf("."),0);
							var multiNumber;
							if (sep>-1) {
								var multi = (strConvBUnitKGTonneC44xlength-sep)-1;
								multiNumber = 1;
								for(var k=0;k<multi;k++) {
									multiNumber=multiNumber*10;
								}
							}
							else {
								multiNumber=1;
							}
							// multi = facture multiplicatif afin d'obtenir une valeur entière
							var strConvBUnitKGTonneC44xTemp = checkInt(strConvBUnitKGTonneC44x.replaceString(".",""),0);
							var iCoefMult = multiNumber * iNumberofPackagedItemsBUnit * (poidsDouble * 1000);
							var strCoefMult = reformatDouble(iCoefMult,1,0);
							//
							var icoefcorrec=1;
							if(strCoefMult>99999) {
								if(strCoefMult<999999) {
									icoefcorrec=10;
								}
								else if(strCoefMult<9999999) {
									icoefcorrec=100;
								}
								else if(strCoefMult<99999999) {
									icoefcorrec=1000;
								}
								else if(strCoefMult<999999999) {
									icoefcorrec=10000;
								}
								strCoefMult=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strCoefMult,icoefcorrec);
								strConvBUnitKGTonneC44xTemp=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strConvBUnitKGTonneC44xTemp,icoefcorrec);
							}
							if(strConvBUnitKGTonneC44xTemp>99999) {
								if(strConvBUnitKGTonneC44xTemp<999999) {
									icoefcorrec=10;
								}
								else if(strConvBUnitKGTonneC44xTemp<9999999) {
									icoefcorrec=100;
								}
								else if(strConvBUnitKGTonneC44xTemp<99999999) {
									icoefcorrec=1000;
								}
								else if(strConvBUnitKGTonneC44xTemp<999999999) {
									icoefcorrec=10000;
								}
								strCoefMult=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strCoefMult,icoefcorrec);
								strConvBUnitKGTonneC44xTemp=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("roundNum").invoke(strConvBUnitKGTonneC44xTemp,icoefcorrec);
							}
							//
							var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strConvBUnitKGTonneC44xTemp,"TO",strCoefMult,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,"1000");
							aConvBUnit.add(aConvTemp);
						}
					}
				} 
				// ******************************************************
				// Fin conversions Tonne des catalogues C440 et 441
				// ******************************************************
				else if (strUnitKheopsAttribute=="KG") {
					if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
						var iMulti = "1000";
						var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,"1","TO","1000",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
						aConvBUnit.add(aConvTemp);
					}
				} 
				else {
					// ****************************
					// Ajout nouvelle règle de gestion (si le poids est dispo depuis l'attribut 04CP0213-netWeight ou l'attribut 06DN0360-GrossWeight
					// ****************************
					if (poidsNetDoubletonneBUnit!=null && poidsNetDoubletonneBUnit>0) {
						var aTOConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsNetDoubletonneBUnit,1);
						var strTOConv = checkString(aTOConv["UnitValueConv"],"");
						var iTOCoef = checkString(aTOConv["Coef"],"");
						var iMulti = checkString(aTOConv["Multi"],"");
						//
						if(strTOConv!="" && iTOCoef!="") {
							if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strTOConv,"TO",iTOCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvBUnit.add(aConvTemp);
							}
						}								
					}
					else if (poidsDoubletonneBUnit!=null && poidsDoubletonneBUnit>0) {
						var aTOConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsDoubletonneBUnit,1);
						var strTOConv = checkString(aTOConv["UnitValueConv"],"");
						var iTOCoef = checkString(aTOConv["Coef"],"");
						var iMulti = checkString(aTOConv["Multi"],"");
						//
						if(strTOConv!="" && iTOCoef!="") {
							if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strTOConv,"TO",iTOCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvBUnit.add(aConvTemp);
							}
						}
					}
				}
			}
			else if (strUnitType=="L") {
				if (strUnitKheopsAttribute=="M3") {
					if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
						var iMulti = "1";
						var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,"1000","L","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
						aConvBUnit.add(aConvTemp);
					}
				} 
				else {
					if (volumeDoublelitreBUnit!=null && volumeDoublelitreBUnit>0) {
						var aLConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(volumeDoublelitreBUnit,1);
						var strLConv = checkString(aLConv["UnitValueConv"],"");
						var iLCoef = checkString(aLConv["Coef"],"");
						var iMulti = checkString(aLConv["Multi"],"");
						//
						if(strLConv!="" && iLCoef!="") {
							if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strLConv,"L",iLCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvBUnit.add(aConvTemp);
							}
						}								
					}
				}
			}
			else if (strUnitType=="ML") {
				if (strUnitKheopsAttribute=="L") {
					if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
						var iMulti = "1";
						var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,"1000","ML","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
						aConvBUnit.add(aConvTemp);
					}
				} 
				else {
					if (volumeDoublemillilitreBUnit!=null && volumeDoublemillilitreBUnit>0) {
						var aMLConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(volumeDoublemillilitreBUnit,1);
						var strMLConv = checkString(aMLConv["UnitValueConv"],"");
						var iMLCoef = checkString(aMLConv["Coef"],"");
						var iMulti = checkString(aMLConv["Multi"],"");
						//
						if(strMLConv!="" && iMLCoef!="") {
							if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strMLConv,"ML",iMLCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvBUnit.add(aConvTemp);
							}
						}								
					}
				}
			}
			else if (strUnitType=="G") {
				if (strUnitKheopsAttribute=="KG") {
					if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
						var iMulti = "1";
						var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,"1000","G","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
						aConvBUnit.add(aConvTemp);
					}
				} 
				else {
					// ****************************
					// Ajout nouvelle règle de gestion (si le poids est dispo depuis l'attribut 04CP0213-netWeight ou l'attribut 06DN0360-GrossWeight
					// ****************************
					if (poidsNetDoublegrammeBUnit!=null && poidsNetDoublegrammeBUnit>0) {
						var aGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsNetDoublegrammeBUnit,1);
						var strGConv = checkString(aGConv["UnitValueConv"],"");
						var iGCoef = checkString(aGConv["Coef"],"");
						var iMulti = checkString(aGConv["Multi"],"");
						//
						if(strGConv!="" && iGCoef!="") {
							if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strGConv,"G",iGCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvBUnit.add(aConvTemp);
							}
						}
					}
					else if (poidsDoublegrammeBUnit!=null && poidsDoublegrammeBUnit>0){
						var aGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsDoublegrammeBUnit,1);
						var strGConv = checkString(aGConv["UnitValueConv"],"");
						var iGCoef = checkString(aGConv["Coef"],"");
						var iMulti = checkString(aGConv["Multi"],"");
						//
						if(strGConv!="" && iGCoef!="") {
							if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strGConv,"G",iGCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvBUnit.add(aConvTemp);
							}
						}
					}
				}
			}
			else if (strUnitType=="M3") {
				if (volumeDoubleBUnit!=null && volumeDoubleBUnit!="") {
					var aM3Conv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(volumeDoubleBUnit,1);
					var strM3Conv = checkString(aM3Conv["UnitValueConv"],"");
					var iM3Coef = checkString(aM3Conv["Coef"],"");
					var iMulti = checkString(aM3Conv["Multi"],"");
					//
					if(strM3Conv!="" && iM3Coef!="") {
						if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
							var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,strM3Conv,"M3",iM3Coef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
							aConvBUnit.add(aConvTemp);
						}
					}
				}
			}
			else if (strUnitType=="ST") {
				if (strUnitKheopsAttribute=="KG" && (strCatalogCode=="C440" || strCatalogCode=="C441")) {
					if(largeurDoublemillimBUnit!=null && largeurDoublemillimBUnit>0) {
						var dconvC44xPackaging = (22*(largeurDoublemillimBUnit/10));
						//
						var aPCConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(dconvC44xPackaging,1);
						var strPCConv = checkString(aPCConv["UnitValueConv"],"");
						var iPCCoef = checkString(aPCConv["Coef"],"");
						var iMulti = checkString(aPCConv["Multi"],"");
						//
						if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
							if(strPCConv!="" && iPCCoef!="") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,iPCCoef,"ST",strPCConv,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvBUnit.add(aConvTemp);
							}
						}
					}
				}
				else {
					var iNumberofPackagedItemsBUnit;
					var oNumberofPackagedItemsBUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"06DN0402-NumberOfPackagedItems");
					if(oNumberofPackagedItemsBUnitEn!=null) {
						iNumberofPackagedItemsBUnit = oNumberofPackagedItemsBUnitEn[0].getEntryNodeValue();
					}
					//
					if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
						var iMulti = "1";
						var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,"1","ST",iNumberofPackagedItemsBUnit,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
						aConvBUnit.add(aConvTemp);
					}
				}
			}
			else if (strUnitType=="ST3") {
				if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
					var iMulti = "1";
					var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,"1","ST3","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
					aConvBUnit.add(aConvTemp);
				}
			}
			else if (strUnitType=="BAG" || strUnitType=="BOX" || strUnitType=="KAR" || strUnitType=="PAK"  || strUnitType=="BGE") {
				var multiNumber=1;
				//
				if (strUnitKheopsAttribute=="KG") {
					// ****************************
					// Ajout nouvelle règle de gestion (si le poids est dispo depuis l'attribut 04CP0213-netWeight ou l'attribut 06DN0360-GrossWeight
					// ****************************
					if (poidsNetDoubleBUnit!=null && poidsNetDoubleBUnit>0) {
						var aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsNetDoubleBUnit,1);
						var strKGConv = checkString(aKGConv["UnitValueConv"],"");
						var iKGCoef = checkString(aKGConv["Coef"],"");
						var iMulti = checkString(aKGConv["Multi"],"");
						//
						if(strKGConv!="" && iKGCoef!="") {
							if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,iKGCoef,strUnitType,strKGConv,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,strKGConv);
								aConvBUnit.add(aConvTemp);
							}
						}
					}
					else if (poidsDoubleBUnit!=null && poidsDoubleBUnit>0) {
						var aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsDoubleBUnit,1);
						var strKGConv = checkString(aKGConv["UnitValueConv"],"");
						var iKGCoef = checkString(aKGConv["Coef"],"");
						var iMulti = checkString(aKGConv["Multi"],"");
						//
						if(strKGConv!="" && iKGCoef!="") {
							if (strTradeItemOrderable=="true" || bBUnitRelevance=="true" || bInactiveItemToProcess=="true") {
								var aConvTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getConvArray").invoke(strMATNR,iKGCoef,strUnitType,strKGConv,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvBUnit.add(aConvTemp);
							}
						}
					}
				}
			}
		}
	}
	return aConvBUnit;
}

// **********************************************************
// Manage PItem1 conversions
// **********************************************************
function managePItem1Conversions(oChildItem,hmGlobals) {
	var aConvPItem1=[];
	//
	// var log = getLogger("Lafarge.DataEntry");
	
	var strChildItemPK = oChildItem.getPrimaryKey();
	var strCatalogName = oChildItem.getCatalog().getCtgName();
	strCatalogName = replace(strCatalogName,"CA","");
	strCatalogName = replace(strCatalogName,"C","");
	var strCatalogCode = concat("C",substring(strCatalogName,0,3));
	var oBUnitItem = oChildItem.getItemUsingEntryRelationshipAttrib(hmGlobals["PARENT_RELATIONSHIP_FIELD"]);
	var oProdItem = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getPublishingItemAtLevel").invoke(oChildItem, "Prod");
	var strMATNRPitem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getMATNRSAPCode").invoke(oChildItem,"PItem");

	var strItemStatus = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getStatus").invoke(oChildItem);
	var strMaterialNumber="";
	var oMaterialNumberEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oChildItem,"01AC0664-MaterialNumber");
	if(oMaterialNumberEn!=null) {
		strMaterialNumber = checkString(oMaterialNumberEn.getEntryNodeValue(),"");
	}
	var bInactiveItemToProcess="false";
	if(strItemStatus=="INACTIVE" && strMaterialNumber!="") {
		bInactiveItemToProcess="true";
	}
	
	var bPItem1Relevance=false;
	var strBUnitSAPRelevanceLkpName="L907-BUnitSAPRelevance";
	var oBUnitSAPRelevanceLkp = getCtgByName(strBUnitSAPRelevanceLkpName);
	var oBUnitSAPRelevanceItem = oBUnitSAPRelevanceLkp.getEntryByPrimaryKey(strCatalogCode);
	if(oBUnitSAPRelevanceItem!=null) {
		bPItem1Relevance = oBUnitSAPRelevanceItem.getEntryAttrib("SL907-BUnitSAPRelevance/C03-RelevancePItem1Level");
	}

	var strULRef1 = "";
	var strULRef2 = "";
	var ChannelOfDistributionGroup = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup");
	var r;
	if(ChannelOfDistributionGroup!=null){
		for(r=0;r<ChannelOfDistributionGroup.size();r++){
			var enChannelOfDistribution = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0422-ChannelOfDistribution");
			if(enChannelOfDistribution!=null) {
				var strChannelOfDistribution = checkString(enChannelOfDistribution.getEntryNodeValue(),"");
				if(strChannelOfDistribution=="[01] - Negoce"){
					var strSecSpecName = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"01AC0014-invoiceName").getEntryNodeExactPath();
					if(strSecSpecName!=null && strSecSpecName!="") {
						strSecSpecName = substring(strSecSpecName,1);
						strSecSpecName = checkString(substring(strSecSpecName,0,strSecSpecName.indexOf("/")), "");
						if(strSecSpecName != ""){
							var enPItemLevel1 = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0555-PItemLevel1");
							if(enPItemLevel1!=null) {
								var oULRef1 = oBUnitItem.getItemUsingEntryRelationshipAttrib(strSecSpecName + "/ChannelOfDistributionGroup#" + r + "/06DN0555-PItemLevel1");
								if(oULRef1!=null) {
									strULRef1 = checkString(oULRef1.getPrimaryKey(),"");
								}
							}
							var enPItemLevel2 = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0556-PItemLevel2");
							if(enPItemLevel2!=null) {
								var oULRef2 = oBUnitItem.getItemUsingEntryRelationshipAttrib(strSecSpecName + "/ChannelOfDistributionGroup#" + r + "/06DN0556-PItemLevel2");
								if(oULRef2!=null) {
									strULRef2 = checkString(oULRef2.getPrimaryKey(),"");
								}
							}
						}
					}
				}
			}
		}
	}
	if(strULRef1=="") {
		if(ChannelOfDistributionGroup!=null){
			for(r=0;r<ChannelOfDistributionGroup.size();r++){
				var enChannelOfDistribution = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0422-ChannelOfDistribution");
				if(enChannelOfDistribution!=null) {
					var strChannelOfDistribution = checkString(enChannelOfDistribution.getEntryNodeValue(),"");
					// if(strChannelOfDistribution=="[02] - Grand Public"){
					if(strChannelOfDistribution!="[01] - Negoce"){
						var enPItemLevel1 = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0555-PItemLevel1");
						if(enPItemLevel1!=null) {
							var strSecSpecName = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"01AC0014-invoiceName").getEntryNodeExactPath();
							if(strSecSpecName!=null && strSecSpecName!="") {
								strSecSpecName = substring(strSecSpecName,1);
								strSecSpecName = checkString(substring(strSecSpecName,0,strSecSpecName.indexOf("/")), "");
								if(strSecSpecName != ""){
									var oULRef1 = oBUnitItem.getItemUsingEntryRelationshipAttrib(strSecSpecName + "/ChannelOfDistributionGroup#" + r + "/06DN0555-PItemLevel1");
									if(oULRef1!=null) {
										strULRef1 = checkString(oULRef1.getPrimaryKey(),"");
									}
								}
							}
						}
					}
				}
			}
		}
	}
	if(strULRef2=="") {
		if(ChannelOfDistributionGroup!=null){
			for(r=0;r<ChannelOfDistributionGroup.size();r++){
				var enChannelOfDistribution = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0422-ChannelOfDistribution");
				if(enChannelOfDistribution!=null) {
					var strChannelOfDistribution = checkString(enChannelOfDistribution.getEntryNodeValue(),"");
					// if(strChannelOfDistribution=="[02] - Grand Public"){
					if(strChannelOfDistribution!="[01] - Negoce"){
						var enPItemLevel2 = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0556-PItemLevel2");
						if(enPItemLevel2!=null) {
							var strSecSpecName = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"01AC0014-invoiceName").getEntryNodeExactPath();
							if(strSecSpecName!=null && strSecSpecName!="") {
								strSecSpecName = substring(strSecSpecName,1);
								strSecSpecName = checkString(substring(strSecSpecName,0,strSecSpecName.indexOf("/")), "");
								if(strSecSpecName != ""){
									var oULRef2 = oBUnitItem.getItemUsingEntryRelationshipAttrib(strSecSpecName + "/ChannelOfDistributionGroup#" + r + "/06DN0556-PItemLevel2");
									if(oULRef2!=null) {
										strULRef2 = checkString(oULRef2.getPrimaryKey(),"");
									}
								}
							}
						}
					}
				}
			}
		}
	}
	
	// Surface
	var surfaceArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getSurface").invoke(oChildItem);
	var surfaceDoublePItem1 = surfaceArrayPItem1["m2"];

	// Longueur
	var longueurArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLongueurPItem").invoke(oChildItem);
	var longueurDoublePItem1 = longueurArrayPItem1["m"];
	var longueurDoublehectomPItem1= longueurArrayPItem1["hm"];
	var longueurDoublemillimPItem1= longueurArrayPItem1["mm"];

	// Volume
	var volumeArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getVolume").invoke(oChildItem);
	var volumeDoublePItem1 = volumeArrayPItem1["m3"];
	var volumeDoublelitrePItem1 = volumeArrayPItem1["l"];
	var volumeDoublemillilitrePItem1 = volumeArrayPItem1["ml"];

	// Poids net
	var poidsNetArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsNet").invoke(oChildItem);
	var poidsNetDoublePItem1 = poidsNetArrayPItem1["kg"];
	var poidsNetDoubletonnePItem1 = poidsNetArrayPItem1["to"];
	var poidsNetDoublegrammePItem1 = poidsNetArrayPItem1["g"];

	// Poids brut
	var poidsBrutArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsBrut").invoke(oChildItem);
	var poidsDoublePItem1 = poidsBrutArrayPItem1["kg"];
	var poidsDoubletonnePItem1 = poidsBrutArrayPItem1["to"];
	var poidsDoublegrammePItem1 = poidsBrutArrayPItem1["g"];

	// Surface
	var surfaceArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getSurface").invoke(oBUnitItem);
	var surfaceDoubleBUnit = surfaceArrayBUnit["m2"];

	// Longueur
	var longueurArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLongueur").invoke(oBUnitItem);
	var longueurDoubleBUnit = longueurArrayBUnit["m"];
	var longueurDoublehectomBUnit= longueurArrayBUnit["hm"];
	var longueurDoublemillimBUnit= longueurArrayBUnit["mm"];

	// Volume
	var volumeArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getVolume").invoke(oBUnitItem);
	var volumeDoubleBUnit = volumeArrayBUnit["m3"];
	var volumeDoublelitreBUnit = volumeArrayBUnit["l"];
	var volumeDoublemillilitreBUnit = volumeArrayBUnit["ml"];

	// Poids net
	var poidsNetArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsNet").invoke(oBUnitItem);
	var poidsNetDoubleBUnit = poidsNetArrayBUnit["kg"];
	var poidsNetDoubletonneBUnit = poidsNetArrayBUnit["to"];
	var poidsNetDoublegrammeBUnit = poidsNetArrayBUnit["g"];

	// Poids brut
	var poidsBrutArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsBrut").invoke(oBUnitItem);
	var poidsDoubleBUnit = poidsBrutArrayBUnit["kg"];
	var poidsDoubletonneBUnit = poidsBrutArrayBUnit["to"];
	var poidsDoublegrammeBUnit = poidsBrutArrayBUnit["g"];	

	// Règles nouveaux attributs
	var strTradeItemOrderable="";
	var oTradeItemOrderableEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oChildItem,"06DN0347-TradeItemOrderable");
	if(oTradeItemOrderableEn!=null) {
		strTradeItemOrderable = checkString(oTradeItemOrderableEn[0].getEntryNodeValue(),"");
	}

	// 06DN0661-BaseUnitOfMeasure
	var strBaseUnitOfMeasureSAP="";
	var strBaseUnitOfMeasure="";
	var oBaseUnitOfMeasureEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oChildItem,"06DN0661-BaseUnitOfMeasure");
	if(oBaseUnitOfMeasureEn!=null) {
		strBaseUnitOfMeasure = checkString(oBaseUnitOfMeasureEn[0].getEntryNodeValue(),"");
		if(strBaseUnitOfMeasure!="") {
			// var iBaseUnitOfMeasureEndCode = strBaseUnitOfMeasure.indexOf("]");
			// strBaseUnitOfMeasureSAP = substring(strBaseUnitOfMeasure,1,iBaseUnitOfMeasureEndCode);
			strBaseUnitOfMeasureSAP = strBaseUnitOfMeasure;
		}
	}

	// 06DN0661-BaseUnitOfMeasure - BUnit
	var strBaseUnitOfMeasureBUnitSAP="";
	var strBaseUnitOfMeasureBUnit="";
	var oBaseUnitOfMeasureBUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oBUnitItem,"06DN0661-BaseUnitOfMeasure");
	if(oBaseUnitOfMeasureBUnitEn!=null) {
		strBaseUnitOfMeasureBUnit = checkString(oBaseUnitOfMeasureBUnitEn[0].getEntryNodeValue(),"");
		if(strBaseUnitOfMeasureBUnit!="") {
			strBaseUnitOfMeasureBUnitSAP = strBaseUnitOfMeasureBUnit;
		}
	}
	
	// Retrieve BaseUnitOfMesure code from L210
	var strBaseUnitOfMeasureL210="";
	var oL210Lkp = getCtgByName("L210-Unités normées - normalized units");
	var oL210LkpItemSet = oL210Lkp.getItemSetForCatalog();
	forEachItemSetElement(oL210LkpItemSet,oL210LkpItem) {
		var strSAPCode = oL210LkpItem.getEntryAttrib("SL210-normalized_units/C05-Code SAP");
		if(strSAPCode==strBaseUnitOfMeasureSAP) {
			strBaseUnitOfMeasureL210=oL210LkpItem.getEntryAttrib("SL210-normalized_units/C00-DisplayName");
		}
	}
	// out.writeln("strBaseUnitOfMeasureSAP="+strBaseUnitOfMeasureSAP);
	
	// SupportOfPacking
	var strSupportOfPacking = "";
	var strSupportOfPackingSAP = "";
	var oSupportOfPackingEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oChildItem,"06DN0399-SupportOfPacking");
	if (oSupportOfPackingEn!=null) {
		strSupportOfPacking = checkString(oSupportOfPackingEn.getEntryNodeValue(),"");
		if(strSupportOfPacking!="") {
			var lkp195 = getCtgByName("L195-Type d emballage - Packing type");
			var olkpitem = lkp195.getEntryByPrimaryKey(strSupportOfPacking);
			if(olkpitem!=null) {
				strSupportOfPackingSAP=olkpitem.getEntryAttrib("SL195-Packing_type/C06-SAP Code");
			}
		}
	}
	var strSupportOfPackingPItem1SAP = strSupportOfPackingSAP;
	
	// SupportOfPacking - BUnit
	var strSupportOfPackingBUnit = "";
	var strSupportOfPackingBUnitSAP = "";
	var oSupportOfPackingBUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"06DN0399-SupportOfPacking");
	if (oSupportOfPackingBUnitEn!=null) {
		strSupportOfPackingBUnit = checkString(oSupportOfPackingBUnitEn.getEntryNodeValue(),"");
		if(strSupportOfPackingBUnit!="") {
			var lkp195 = getCtgByName("L195-Type d emballage - Packing type");
			var olkpitem = lkp195.getEntryByPrimaryKey(strSupportOfPackingBUnit);
			if(olkpitem!=null) {
				strSupportOfPackingBUnitSAP=olkpitem.getEntryAttrib("SL195-Packing_type/C06-SAP Code");
			}
		}
	}
	
	var iDigitsHM="0";
	var strDigitsTypeHM="";
	var bDigitsUnitTypeHM=false;
	var iDigitsTO="0";
	var strDigitsTypeTO="";
	var bDigitsUnitTypeTO=false;
	
	var strChildItemType = getScriptByPath("/scripts/triggers/LG.Business.Initial.Rules").getFunctionByName("getItemType").invoke(oChildItem,hmGlobals);
	if (strChildItemType!=null && strChildItemType!=""){
		var oNumberofPackagedItemsEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oChildItem,"06DN0402-NumberOfPackagedItems");
		if(oNumberofPackagedItemsEn!=null) {
			var iNumberofPackagedItemsInit = oNumberofPackagedItemsEn[0].getEntryNodeValue();
			if(iNumberofPackagedItemsInit!=null) {
				strChildItemType = strChildItemType.replaceString(" ","");
				var strItemType2 = substring(strChildItemType,2,strChildItemType.length());
				var strUnitKheopsAttribute = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getBaseUnitAttrNameFromL906").invoke(strCatalogCode,"Bunit",oBUnitItem,hmGlobals);
				var unittypesTemp = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getUnitsFromCurrentItemType").invoke(strCatalogCode,strItemType2,oChildItem,hmGlobals);
				
				// var log = getLogger("Lafarge.DataEntry");
				// log.loggerDebug("ITEM Conversions unittypesTemp=" + unittypesTemp);

				if (unittypesTemp!=null) {
					var unittypes = getScriptByPath("/scripts/triggers/LG.Library.Utils").getFunctionByName("getDeduplicatedArray").invoke(unittypesTemp);
					
					// log.loggerDebug("ITEM Conversions unittypes=" + unittypes);
					
					unittypes = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("deleteBaseUnitOfMesureFromUnitList").invoke(unittypes,strBaseUnitOfMeasureSAP);
					//
					// out.writeln("strUnitKheopsAttribute="+strUnitKheopsAttribute);

					// log.loggerDebug("ITEM Conversions unittypes avec DEL =" + unittypes);
					
					var strEANCode = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCode").invoke(oBUnitItem,strTradeItemOrderable);
					var strEANCategory = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCategory").invoke(oBUnitItem,strEANCode);

					// Poids brut caractéristiques physiques
					var poidsBrut04CPArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsBrut04CP").invoke(oBUnitItem);
					var poids04CPDoubleBUnit = poidsBrut04CPArrayBUnit["kg"];

					// Largeur Prod
					var largeurArrayProd = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLargeur").invoke(oProdItem);
					var largeurDoubleBUnit = largeurArrayProd["m"];
					var largeurDoublehectomProd = largeurArrayProd["hm"];
					var largeurDoublemillimProd = largeurArrayProd["mm"];

					// Largeur
					var largeurArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLargeur").invoke(oBUnitItem);
					var largeurDoubleBUnit = largeurArrayBUnit["m"];
					var largeurDoublehectomBUnit= largeurArrayBUnit["hm"];
					var largeurDoublemillimBUnit= largeurArrayBUnit["mm"];	

					var strLargeur;
					if(largeurDoublemillimBUnit!=null && largeurDoublemillimBUnit>0) {
						// strLargeur = largeurDoublemillimBUnit;
						strLargeur = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("reformatDoubleCustomForDoubleField").invoke(largeurDoublemillimBUnit);
					}
					if(largeurDoublemillimProd!=null && largeurDoublemillimProd>0) {
						// strLargeur = largeurDoublemillimProd;
						strLargeur = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("reformatDoubleCustomForDoubleField").invoke(largeurDoublemillimProd);
					}
					if(strLargeur==null) {
						strLargeur="";
					}

					// RealThickness
					var oItemProd = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getParentItem").invoke(hmGlobals,oBUnitItem);
					var realThicknessProd = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getRealThicknessProd").invoke(oItemProd);
					var realThicknessDoubleProd = realThicknessProd["mm"];

					// Thickness
					var thicknessBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getThicknessBUnit").invoke(oBUnitItem);
					var thicknessDoubleBUnit = thicknessBUnit["mm"];

					var strThickness;
					if(realThicknessDoubleProd!=null && realThicknessDoubleProd>0) {
						strThickness = realThicknessDoubleProd;
					}
					if(thicknessDoubleBUnit!=null && thicknessDoubleBUnit>0) {
						strThickness = thicknessDoubleBUnit;
					}
					if(strThickness==null) {
						strThickness="";
					}
					//
					var strEANCodePItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCode").invoke(oChildItem,strTradeItemOrderable);
					var strEANCategoryPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCategory").invoke(oChildItem,strEANCodePItem1);

					// Largeur
					var largeurArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLargeurPItem").invoke(oChildItem);							
					var largeurDoublemillimPItem1= largeurArrayPItem1["mm"];	
					
					// Poids brut caractéristiques physiques
					var poidsBrut04CPArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsBrut04CP").invoke(oChildItem);
					var poids04CPDoublePItem1 = poidsBrut04CPArrayPItem1["kg"];

					// Thickness
					var thicknessPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getThicknessPItem").invoke(oChildItem);
					var thicknessDoublePItem1 = thicknessPItem1["mm"];
					//
					var strSAPUnitType = strBaseUnitOfMeasureSAP;
					if(
					(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
					(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType!=strSupportOfPackingSAP && strSAPUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
					(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType!=strSupportOfPackingSAP && strSAPUnitType!=strSupportOfPackingPItem1SAP && strSAPUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
					(strSAPUnitType==strBaseUnitOfMeasureSAP && strSAPUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
					(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
					(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType!=strSupportOfPackingSAP && strSAPUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
					(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType!=strSupportOfPackingSAP && strSAPUnitType!=strSupportOfPackingPItem1SAP && strSAPUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
					(strSAPUnitType==strBaseUnitOfMeasureSAP && strSAPUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
					(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
					){
						if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
							var iMulti = "1";
							if(strSAPUnitType==strSupportOfPackingSAP){
								var aConvTemp = getConvArray(strMATNRPitem1,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,strEANCodePItem1,strEANCategoryPItem1,poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
								aConvPItem1.add(aConvTemp);
							}
							else if((strSAPUnitType==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK || strULRef2==strChildItemPK)) && strCatalogCode!="C120") {
								var aConvTemp = getConvArray(strMATNRPitem1,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,strEANCode,strEANCategory,poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
								aConvPItem1.add(aConvTemp);
							}
							else {
								var aConvTemp = getConvArray(strMATNRPitem1,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
								aConvPItem1.add(aConvTemp);
							}
						}
						//
						unittypes=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("removeValueFromArray").invoke(unittypes,strBaseUnitOfMeasureSAP);
					}
					else if(strSAPUnitType==strBaseUnitOfMeasureSAP && strSAPUnitType!=strSupportOfPackingSAP) {
						if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
							var iMulti = "1";
							if((strULRef1==strChildItemPK || strULRef2==strChildItemPK) && strCatalogCode!="C120") {
								var aConvTemp = getConvArray(strMATNRPitem1,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,strEANCode,strEANCategory,poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvPItem1.add(aConvTemp);
							}
							else {
								var aConvTemp = getConvArray(strMATNRPitem1,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvPItem1.add(aConvTemp);							
							}
						}
						//
						unittypes=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("removeValueFromArray").invoke(unittypes,strBaseUnitOfMeasureSAP);						
					}
					//
					
					unittypes = sortUnits(unittypes);
					
					// log.loggerDebug("ITEM Conversions unittypes FIN =" + unittypes);
					
					// Other conversions
					for (var j=0;j<unittypes.size(); j++) {
						var strUnitType = unittypes[j];
						
						// log.loggerDebug("ITEM Conversions strUnitType =" + strUnitType);
						
						//
						var	iNumberofPackagedItems = iNumberofPackagedItemsInit;
						//
						if (strUnitType=="ST" || strUnitType=="PAL" || strUnitType=="BAG" || strUnitType=="BOX" || strUnitType=="KAR" || strUnitType=="PAK"  || strUnitType=="BGE") {
							var multiNumber=1;
							var iMulti = "1";
							//
							var strSAPUnitType = "";
							if (strUnitType=="PAL") {
								strSAPUnitType = "PAL";
							}
							else if (strUnitType=="BOX") {
								strSAPUnitType = "BOX";
							}
							else if (strUnitType=="KAR") {
								strSAPUnitType = "KAR";
							}
							else if (strUnitType=="PAK") {
								strSAPUnitType = "PAK";
							}
							else if (strUnitType=="ST") {
								strSAPUnitType = "ST";
								multiNumber=iNumberofPackagedItems;
							}
							else if (strUnitType=="BAG") {
								strSAPUnitType = "BAG";
							}
							else if (strUnitType=="BGE") {
								strSAPUnitType = "BGE";
							}
							//		
							// out.writeln("strUnitType="+strUnitType);
							// out.writeln("strBaseUnitOfMeasureSAP="+strBaseUnitOfMeasureSAP);
							// out.writeln("strSupportOfPackingSAP="+strSupportOfPackingSAP);
							// out.writeln("strSupportOfPackingPItem1SAP="+strSupportOfPackingPItem1SAP);
							// out.writeln("strSupportOfPackingBUnitSAP="+strSupportOfPackingBUnitSAP);
							// out.writeln("strBaseUnitOfMeasureBUnitSAP="+strBaseUnitOfMeasureBUnitSAP);
							//		
							// out.writeln("strChildItemPK="+strChildItemPK);
							// out.writeln("strULRef1="+strULRef1);
							//
							if(
							(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
							(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType!=strSupportOfPackingSAP && strSAPUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
							(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType!=strSupportOfPackingSAP && strSAPUnitType!=strSupportOfPackingPItem1SAP && strSAPUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
							(strSAPUnitType==strBaseUnitOfMeasureSAP && strSAPUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
							(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
							(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType!=strSupportOfPackingSAP && strSAPUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
							(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType!=strSupportOfPackingSAP && strSAPUnitType!=strSupportOfPackingPItem1SAP && strSAPUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
							(strSAPUnitType==strBaseUnitOfMeasureSAP && strSAPUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
							(strSAPUnitType!=strBaseUnitOfMeasureSAP && strSAPUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
							){
								if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
									if(strSAPUnitType==strSupportOfPackingSAP){
										var aConvTemp = getConvArray(strMATNRPitem1,multiNumber,strSAPUnitType,iNumberofPackagedItems,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,strEANCodePItem1,strEANCategoryPItem1,poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem1.add(aConvTemp);
									}
									else if((strSAPUnitType==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK || strULRef2==strChildItemPK)) && strCatalogCode!="C120") {
										var aConvTemp = getConvArray(strMATNRPitem1,multiNumber,strSAPUnitType,iNumberofPackagedItems,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,strEANCode,strEANCategory,poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem1.add(aConvTemp);
									}
									else {
										var aConvTemp = getConvArray(strMATNRPitem1,multiNumber,strSAPUnitType,iNumberofPackagedItems,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem1.add(aConvTemp);
									}
								}
							}
							else if(strSAPUnitType==strBaseUnitOfMeasureSAP && strSAPUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
								if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
									if((strSAPUnitType==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK || strULRef2==strChildItemPK)) && strCatalogCode!="C120") {
										var aConvTemp = getConvArray(strMATNRPitem1,multiNumber,strSAPUnitType,iNumberofPackagedItems,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,strEANCode,strEANCategory,poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem1.add(aConvTemp);
									}
									else {
										var aConvTemp = getConvArray(strMATNRPitem1,multiNumber,strSAPUnitType,iNumberofPackagedItems,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem1.add(aConvTemp);									
									}
								}
							}
							else {
								if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
									if(strUnitType=="ST") {
										var aConvTemp = getConvArray(strMATNRPitem1,iNumberofPackagedItems,strSAPUnitType,iNumberofPackagedItems,"","","","","","","","",iMulti);
										aConvPItem1.add(aConvTemp);
									} else {
										var aConvTemp = getConvArray(strMATNRPitem1,multiNumber,strSAPUnitType,iNumberofPackagedItems,"","","","","","","","",iMulti);
										aConvPItem1.add(aConvTemp);									
									}
								}
							}
						}
						else if (strUnitType=="M2") {
							var aM2Conv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(surfaceDoubleBUnit,iNumberofPackagedItems);
							var strM2Conv = checkString(aM2Conv["UnitValueConv"],"");
							var iM2Coef = checkString(aM2Conv["Coef"],"");
							var iMulti = checkString(aM2Conv["Multi"],"");
							//
							if(strM2Conv!="" && iM2Coef!="") {
								if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
									if(
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem1,strM2Conv,"M2",iM2Coef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem1.add(aConvTemp);
									}
									else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem1,strM2Conv,"M2",iM2Coef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem1.add(aConvTemp);
									}
								}
							}
						}
						else if (strUnitType=="M") {
							var aMConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(longueurDoubleBUnit,iNumberofPackagedItems);
							var strMConv = checkString(aMConv["UnitValueConv"],"");
							var iMCoef = checkString(aMConv["Coef"],"");
							var iMulti = checkString(aMConv["Multi"],"");
							//
							if(strMConv!="" && iMCoef!="") {
								if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
									if(
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem1,strMConv,"M",iMCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem1.add(aConvTemp);
									}
									else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem1,strMConv,"M",iMCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem1.add(aConvTemp);
									}
								}
							}
						}
						else if (strUnitType=="HM") {
							var aHMConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(longueurDoublehectomBUnit,iNumberofPackagedItems);
							var strHMConv = checkString(aHMConv["UnitValueConv"],"");
							var iHMCoef = checkString(aHMConv["Coef"],"");
							var iMulti = checkString(aHMConv["Multi"],"");
							//
							if(strHMConv!="" && iHMCoef!="") {
								if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
									if(
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem1,strHMConv,"HM",iHMCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem1.add(aConvTemp);
									}
									else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem1,strHMConv,"HM",iHMCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem1.add(aConvTemp);									
									}
								}
							}
						}
						else if (strUnitType=="KG") {
							if (strUnitKheopsAttribute=="TO") {
								if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
									var iMulti = "1";
									if(
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem1,"1000","KG","1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem1.add(aConvTemp);
									}
									else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem1,"1000","KG","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem1.add(aConvTemp);									
									}
								}
							} 
							else {
								// ****************************
								// Ajout nouvelle règle de gestion (si le poids est dispo depuis l'attribut 04CP0213-netWeight ou l'attribut 06DN0360-GrossWeight
								// ****************************
								var aKGConv;
								if (poidsNetDoublePItem1!=null && poidsNetDoublePItem1>0) {
									aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsNetDoublePItem1,iNumberofPackagedItems);
								}
								else {
									if(poidsDoublePItem1!=null && poidsDoublePItem1>0) {
										aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsDoublePItem1,iNumberofPackagedItems);
									}
									else {
										if (poidsNetDoubleBUnit!=null && poidsNetDoubleBUnit>0) {
											aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsNetDoubleBUnit,iNumberofPackagedItems);
										}
										else {
											if(poidsDoubleBUnit!=null && poidsDoubleBUnit>0) {
												aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsDoubleBUnit,iNumberofPackagedItems);
											}
										}
									}
								}
								if(aKGConv!=null) {
									var strKGConv = checkString(aKGConv["UnitValueConv"],"");
									var iKGCoef = checkString(aKGConv["Coef"],"");
									var iMulti = checkString(aKGConv["Multi"],"");
									//
									if(iDigitsTO!="0" && strDigitsTypeTO=="UMREZ" && bDigitsUnitTypeTO==true) {
										if(iDigitsTO=="10" && strKGConv.length()>1) {
											var iValTemp2 = toInteger(substring(strKGConv,(strKGConv.length()-1),(strKGConv.length())));
											strKGConv=substring(strKGConv,0,(strKGConv.length()-1));
											var iValTemp1 = toInteger(strKGConv);
											if(iValTemp2>5) {
												iValTemp1=iValTemp1+1;
											}
											strKGConv=iValTemp1+"0";
										}
										else if(iDigitsTO=="100" && strKGConv.length()>10) {
											var iValTemp2 = toInteger(substring(strKGConv,(strKGConv.length()-2),(strKGConv.length())));
											strKGConv=substring(strKGConv,0,(strKGConv.length()-2));
											var iValTemp1 = toInteger(strKGConv);
											if(iValTemp2>50) {
												iValTemp1=iValTemp1+1;
											}
											strKGConv=iValTemp1+"00";
										}
										else if(iDigitsTO=="1000" && strKGConv.length()>100) {
											var iValTemp2 = toInteger(substring(strKGConv,(strKGConv.length()-3),(strKGConv.length())));
											strKGConv=substring(strKGConv,0,(strKGConv.length()-3));
											var iValTemp1 = toInteger(strKGConv);
											if(iValTemp2>500) {
												iValTemp1=iValTemp1+1;
											}
											strKGConv=iValTemp1+"000";
										}								
									}
									//
									if(strKGConv!="" && iKGCoef!="") {
										if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
											if(
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
											){					
												var aConvTemp = getConvArray(strMATNRPitem1,strKGConv,"KG",iKGCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem1.add(aConvTemp);
											}
											else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem1,strKGConv,"KG",iKGCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem1.add(aConvTemp);
											}
										}
									}
								}
							}
						}
						else if (strUnitType=="L") {
							if (strUnitKheopsAttribute=="M3") {
								if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
									var iMulti = "1";
									if(
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem1,"1000","L","1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem1.add(aConvTemp);
									}
									else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem1,"1000","L","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem1.add(aConvTemp);
									}
								}
							} 
							else {
								if(volumeDoublelitrePItem1!=null && volumeDoublelitrePItem1>0) {
									aLConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(volumeDoublelitrePItem1,iNumberofPackagedItems);
								}
								else {
									if (volumeDoublelitreBUnit!=null && volumeDoublelitreBUnit>0) {
										aLConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(volumeDoublelitreBUnit,iNumberofPackagedItems);
									}
								}
								//
								if(aLConv!=null) {
									var strLConv = checkString(aLConv["UnitValueConv"],"");
									var iLCoef = checkString(aLConv["Coef"],"");
									var iMulti = checkString(aLConv["Multi"],"");
									//
									if(strLConv!="" && iLCoef!="") {
										if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
											if(
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
											){
												var aConvTemp = getConvArray(strMATNRPitem1,strLConv,"L",iLCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem1.add(aConvTemp);
											}
											else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem1,strLConv,"L",iLCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem1.add(aConvTemp);											
											}
										}
									}
								}
							}
						}
						else if (strUnitType=="ML") {
							if (strUnitKheopsAttribute=="L") {
								if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
									var iMulti = "1";
									if(
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem1,"1000","ML","1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem1.add(aConvTemp);
									}
									else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem1,"1000","ML","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem1.add(aConvTemp);
									}
								}
							} 
							else {
								if(volumeDoublemillilitrePItem1!=null && volumeDoublemillilitrePItem1>0) {
									aMLConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(volumeDoublemillilitrePItem1,iNumberofPackagedItems);
								}
								else {
									if (volumeDoublemillilitreBUnit!=null && volumeDoublemillilitreBUnit>0) {
										aMLConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(volumeDoublemillilitreBUnit,iNumberofPackagedItems);
									}
								}
								//
								if(aMLConv!=null) {
									var strMLConv = checkString(aMLConv["UnitValueConv"],"");
									var iMLCoef = checkString(aMLConv["Coef"],"");
									var iMulti = checkString(aMLConv["Multi"],"");
									//
									if(strMLConv!="" && iMLCoef!="") {
										if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
											if(
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
											){
												var aConvTemp = getConvArray(strMATNRPitem1,strMLConv,"ML",iMLCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem1.add(aConvTemp);
											}
											else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem1,strMLConv,"ML",iMLCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem1.add(aConvTemp);
											}
										}
									}
								}
							}
						}
						else if (strUnitType=="TO") {
							if (strUnitKheopsAttribute=="KG") {
								if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
									var iMulti = "1000";
									if(
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem1,"1","TO","1000",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem1.add(aConvTemp);
									}
									else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem1,"1","TO","1000",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem1.add(aConvTemp);
									}
								}
							} 
							else {
								// ****************************
								// Ajout nouvelle règle de gestion (si le poids est dispo depuis l'attribut 04CP0213-netWeight ou l'attribut 06DN0360-GrossWeight
								// ****************************
								var aTOConv;
								if (poidsNetDoubletonnePItem1!=null && poidsNetDoubletonnePItem1>0) {
									aTOConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsNetDoubletonnePItem1,iNumberofPackagedItems);
								}
								else {
									if(poidsDoubletonnePItem1!=null && poidsDoubletonnePItem1>0) {
										aTOConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsDoubletonnePItem1,iNumberofPackagedItems);
									}
									else {
										if (poidsNetDoubletonneBUnit!=null && poidsNetDoubletonneBUnit>0) {
											aTOConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsNetDoubletonneBUnit,iNumberofPackagedItems);
										}
										else {
											if(poidsDoubletonneBUnit!=null && poidsDoubletonneBUnit>0) {
												aTOConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsDoubletonneBUnit,iNumberofPackagedItems);
											}
										}
									}
								}
								if(aTOConv!=null) {
									var strTOConv = checkString(aTOConv["UnitValueConv"],"");
									var iTOCoef = checkString(aTOConv["Coef"],"");
									var iMulti = checkString(aTOConv["Multi"],"");
									iDigitsTO = checkString(aTOConv["Digits"],"");
									strDigitsTypeTO = checkString(aTOConv["DigitsType"],"");								
									bDigitsUnitTypeTO=true;
									//
									if(strTOConv!="" && iTOCoef!="") {
										if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
											if(
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
											){
												var aConvTemp = getConvArray(strMATNRPitem1,strTOConv,"TO",iTOCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem1.add(aConvTemp);
											}
											else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem1,strTOConv,"TO",iTOCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem1.add(aConvTemp);
											}
										}
									}
								}
							}
						}
						else if (strUnitType=="G") {
							if (strUnitKheopsAttribute=="KG") {
								var iMulti = "1";
								if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
									if(
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem1,"1000","G","1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem1.add(aConvTemp);
									}
									else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem1,"1000","G","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem1.add(aConvTemp);									
									}
								}
							} 
							else {
								// ****************************
								// Ajout nouvelle règle de gestion (si le poids est dispo depuis l'attribut 04CP0213-netWeight ou l'attribut 06DN0360-GrossWeight
								// ****************************
								var aGConv;
								if (poidsNetDoublegrammePItem1!=null && poidsNetDoublegrammePItem1>0) {
									aGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsNetDoublegrammePItem1,iNumberofPackagedItems);
								}
								else {
									if(poidsDoubletonnePItem1!=null && poidsDoubletonnePItem1>0) {
										aGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsDoublegrammePItem1,iNumberofPackagedItems);
									}
									else {
										if (poidsNetDoublegrammeBUnit!=null && poidsNetDoublegrammeBUnit>0) {
											aGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsNetDoublegrammeBUnit,iNumberofPackagedItems);
										}
										else {
											if(poidsDoublegrammeBUnit!=null && poidsDoublegrammeBUnit>0) {
												aGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsDoublegrammeBUnit,iNumberofPackagedItems);
											}
										}
									}
								}
								if(aGConv!=null) {
									var strGConv = checkString(aGConv["UnitValueConv"],"");
									var iGCoef = checkString(aGConv["Coef"],"");
									var iMulti = checkString(aGConv["Multi"],"");
									//
									if(strGConv!="" && iGCoef!="") {
										if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
											if(
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
											){
												var aConvTemp = getConvArray(strMATNRPitem1,strGConv,"G",iGCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem1.add(aConvTemp);
											}
											else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem1,strGConv,"G",iGCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem1.add(aConvTemp);											
											}
										}
									}
								}
							}
						}
						else if (strUnitType=="M3") {
							var aM3Conv;
							if(volumeDoublePItem1!=null && volumeDoublePItem1>0) {
								aM3Conv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(volumeDoublePItem1,iNumberofPackagedItems);
							}
							else {
								aM3Conv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(volumeDoubleBUnit,iNumberofPackagedItems);
							}
							if(aM3Conv!=null) {
								var strM3Conv = checkString(aM3Conv["UnitValueConv"],"");
								var iM3Coef = checkString(aM3Conv["Coef"],"");
								var iMulti = checkString(aM3Conv["Multi"],"");
								//
								if(strM3Conv!="" && iM3Coef!="") {
									if (strTradeItemOrderable=="true" || bPItem1Relevance=="true" || bInactiveItemToProcess=="true") {
										if(
										(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
										(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
										(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
										(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
										(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
										(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
										(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strUnitType!=strSupportOfPackingPItem1SAP && strUnitType!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
										(strUnitType==strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
										(strUnitType!=strBaseUnitOfMeasureSAP && strUnitType==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
										){
											var aConvTemp = getConvArray(strMATNRPitem1,strM3Conv,"M3",iM3Coef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
											aConvPItem1.add(aConvTemp);
										}
										else if(strUnitType==strBaseUnitOfMeasureSAP && strUnitType!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
											var aConvTemp = getConvArray(strMATNRPitem1,strM3Conv,"M3",iM3Coef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
											aConvPItem1.add(aConvTemp);										
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	return aConvPItem1;
}

function managePItem2Conversions(oChildItem2,hmGlobals) {
	var aConvPItem2=[];
	//
	var strChildItemPK2 = oChildItem2.getPrimaryKey();
	var strCatalogName = oChildItem2.getCatalog().getCtgName();
	strCatalogName = replace(strCatalogName,"CA","");
	strCatalogName = replace(strCatalogName,"C","");
	var strCatalogCode = concat("C",substring(strCatalogName,0,3));
	var oPItem1Item = oChildItem2.getItemUsingEntryRelationshipAttrib(hmGlobals["PARENT_RELATIONSHIP_FIELD"]);
	var oBUnitItem = oPItem1Item.getItemUsingEntryRelationshipAttrib(hmGlobals["PARENT_RELATIONSHIP_FIELD"]);
	var oProdItem = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getPublishingItemAtLevel").invoke(oChildItem2, "Prod");
	var strMATNRPitem2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getMATNRSAPCode").invoke(oChildItem2,"PItem");

	var strItemStatus = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getStatus").invoke(oChildItem2);
	var strMaterialNumber="";
	var oMaterialNumberEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oChildItem2,"01AC0664-MaterialNumber");
	if(oMaterialNumberEn!=null) {
		strMaterialNumber = checkString(oMaterialNumberEn.getEntryNodeValue(),"");
	}
	var bInactiveItemToProcess="false";
	if(strItemStatus=="INACTIVE" && strMaterialNumber!="") {
		bInactiveItemToProcess="true";
	}
	
	var bPItem2Relevance=false;
	var strBUnitSAPRelevanceLkpName="L907-BUnitSAPRelevance";
	var oBUnitSAPRelevanceLkp = getCtgByName(strBUnitSAPRelevanceLkpName);
	var oBUnitSAPRelevanceItem = oBUnitSAPRelevanceLkp.getEntryByPrimaryKey(strCatalogCode);
	if(oBUnitSAPRelevanceItem!=null) {
		bPItem2Relevance = oBUnitSAPRelevanceItem.getEntryAttrib("SL907-BUnitSAPRelevance/C04-RelevancePItem2Level");
	}
	//
	var strULRef1 = "";
	var strULRef2 = "";
	var ChannelOfDistributionGroup = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup");
	var r;
	if(ChannelOfDistributionGroup!=null){
		for(r=0;r<ChannelOfDistributionGroup.size();r++){
			var enChannelOfDistribution = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0422-ChannelOfDistribution");
			if(enChannelOfDistribution!=null) {
				var strChannelOfDistribution = checkString(enChannelOfDistribution.getEntryNodeValue(),"");
				if(strChannelOfDistribution=="[01] - Negoce"){
					var strSecSpecName = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"01AC0014-invoiceName").getEntryNodeExactPath();
					if(strSecSpecName!=null && strSecSpecName!="") {
						strSecSpecName = substring(strSecSpecName,1);
						strSecSpecName = checkString(substring(strSecSpecName,0,strSecSpecName.indexOf("/")), "");
						if(strSecSpecName != ""){
							var enPItemLevel1 = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0555-PItemLevel1");
							if(enPItemLevel1!=null) {
								var oULRef1 = oBUnitItem.getItemUsingEntryRelationshipAttrib(strSecSpecName + "/ChannelOfDistributionGroup#" + r + "/06DN0555-PItemLevel1");
								if(oULRef1!=null) {
									strULRef1 = checkString(oULRef1.getPrimaryKey(),"");
								}
							}
							var enPItemLevel2 = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0556-PItemLevel2");
							if(enPItemLevel2!=null) {
								var oULRef2 = oBUnitItem.getItemUsingEntryRelationshipAttrib(strSecSpecName + "/ChannelOfDistributionGroup#" + r + "/06DN0556-PItemLevel2");
								if(oULRef2!=null) {
									strULRef2 = checkString(oULRef2.getPrimaryKey(),"");
								}
							}
						}
					}
				}
			}
		}
	}
	if(strULRef1=="") {
		if(ChannelOfDistributionGroup!=null){
			for(r=0;r<ChannelOfDistributionGroup.size();r++){
				var enChannelOfDistribution = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0422-ChannelOfDistribution");
				if(enChannelOfDistribution!=null) {
					var strChannelOfDistribution = checkString(enChannelOfDistribution.getEntryNodeValue(),"");
					// if(strChannelOfDistribution=="[02] - Grand Public"){
					if(strChannelOfDistribution!="[01] - Negoce"){
						var enPItemLevel1 = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0555-PItemLevel1");
						if(enPItemLevel1!=null) {
							var strSecSpecName = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"01AC0014-invoiceName").getEntryNodeExactPath();
							if(strSecSpecName!=null && strSecSpecName!="") {
								strSecSpecName = substring(strSecSpecName,1);
								strSecSpecName = checkString(substring(strSecSpecName,0,strSecSpecName.indexOf("/")), "");
								if(strSecSpecName != ""){
									var oULRef1 = oBUnitItem.getItemUsingEntryRelationshipAttrib(strSecSpecName + "/ChannelOfDistributionGroup#" + r + "/06DN0555-PItemLevel1");
									if(oULRef1!=null) {
										strULRef1 = checkString(oULRef1.getPrimaryKey(),"");
									}
								}
							}
						}
					}
				}
			}
		}
	}
	if(strULRef2=="") {
		if(ChannelOfDistributionGroup!=null){
			for(r=0;r<ChannelOfDistributionGroup.size();r++){
				var enChannelOfDistribution = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0422-ChannelOfDistribution");
				if(enChannelOfDistribution!=null) {
					var strChannelOfDistribution = checkString(enChannelOfDistribution.getEntryNodeValue(),"");
					// if(strChannelOfDistribution=="[02] - Grand Public"){
					if(strChannelOfDistribution!="[01] - Negoce"){
						var enPItemLevel2 = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"ChannelOfDistributionGroup#"+r+"/06DN0556-PItemLevel2");
						if(enPItemLevel2!=null) {
							var strSecSpecName = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"01AC0014-invoiceName").getEntryNodeExactPath();
							if(strSecSpecName!=null && strSecSpecName!="") {
								strSecSpecName = substring(strSecSpecName,1);
								strSecSpecName = checkString(substring(strSecSpecName,0,strSecSpecName.indexOf("/")), "");
								if(strSecSpecName != ""){
									var oULRef2 = oBUnitItem.getItemUsingEntryRelationshipAttrib(strSecSpecName + "/ChannelOfDistributionGroup#" + r + "/06DN0556-PItemLevel2");
									if(oULRef2!=null) {
										strULRef2 = checkString(oULRef2.getPrimaryKey(),"");
									}
								}
							}
						}
					}
				}
			}
		}
	}

	// Surface
	var surfaceArrayPItem2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getSurface").invoke(oChildItem2);
	var surfaceDoublePItem2 = surfaceArrayPItem2["m2"];

	// Longueur
	var longueurArrayPItem2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLongueurPItem").invoke(oChildItem2);
	var longueurDoublePItem2 = longueurArrayPItem2["m"];
	var longueurDoublehectomPItem2= longueurArrayPItem2["hm"];
	var longueurDoublemillimPItem2= longueurArrayPItem2["mm"];

	// Volume
	var volumeArrayPItem2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getVolume").invoke(oChildItem2);
	var volumeDoublePItem2 = volumeArrayPItem2["m3"];
	var volumeDoublelitrePItem2 = volumeArrayPItem2["l"];
	var volumeDoublemillilitrePItem2 = volumeArrayPItem2["ml"];

	// Poids net
	var poidsNetArrayPItem2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsNet").invoke(oChildItem2);
	var poidsNetDoublePItem2 = poidsNetArrayPItem2["kg"];
	var poidsNetDoubletonnePItem2 = poidsNetArrayPItem2["to"];
	var poidsNetDoublegrammePItem2 = poidsNetArrayPItem2["g"];

	// Poids brut
	var poidsBrutArrayPItem2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsBrut").invoke(oChildItem2);
	var poidsDoublePItem2 = poidsBrutArrayPItem2["kg"];
	var poidsDoubletonnePItem2 = poidsBrutArrayPItem2["to"];
	var poidsDoublegrammePItem2 = poidsBrutArrayPItem2["g"];

	// Surface
	var surfaceArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getSurface").invoke(oBUnitItem);
	var surfaceDoubleBUnit = surfaceArrayBUnit["m2"];

	// Longueur
	var longueurArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLongueur").invoke(oBUnitItem);
	var longueurDoubleBUnit = longueurArrayBUnit["m"];
	var longueurDoublehectomBUnit= longueurArrayBUnit["hm"];
	var longueurDoublemillimBUnit= longueurArrayBUnit["mm"];
	
	// Volume
	var volumeArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getVolume").invoke(oBUnitItem);
	var volumeDoubleBUnit = volumeArrayBUnit["m3"];
	var volumeDoublelitreBUnit = volumeArrayBUnit["l"];
	var volumeDoublemillilitreBUnit = volumeArrayBUnit["ml"];
	
	// Poids net
	var poidsNetArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsNet").invoke(oBUnitItem);
	var poidsNetDoubleBUnit = poidsNetArrayBUnit["kg"];
	var poidsNetDoubletonneBUnit = poidsNetArrayBUnit["to"];
	var poidsNetDoublegrammeBUnit = poidsNetArrayBUnit["g"];

	// Poids brut
	var poidsBrutArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsBrut").invoke(oBUnitItem);
	var poidsDoubleBUnit = poidsBrutArrayBUnit["kg"];
	var poidsDoubletonneBUnit = poidsBrutArrayBUnit["to"];
	var poidsDoublegrammeBUnit = poidsBrutArrayBUnit["g"];
	
	// Règles nouveaux attributs
	var strTradeItemOrderable="";
	var oTradeItemOrderableEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oChildItem2,"06DN0347-TradeItemOrderable");
	if(oTradeItemOrderableEn!=null) {
		strTradeItemOrderable = checkString(oTradeItemOrderableEn[0].getEntryNodeValue(),"");
	}

	// 06DN0661-BaseUnitOfMeasure
	var strBaseUnitOfMeasureSAP="";
	var strBaseUnitOfMeasure="";
	var oBaseUnitOfMeasureEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oChildItem2,"06DN0661-BaseUnitOfMeasure");
	if(oBaseUnitOfMeasureEn!=null) {
		strBaseUnitOfMeasure = checkString(oBaseUnitOfMeasureEn[0].getEntryNodeValue(),"");
		if(strBaseUnitOfMeasure!="") {
			// var iBaseUnitOfMeasureEndCode = strBaseUnitOfMeasure.indexOf("]");
			// strBaseUnitOfMeasureSAP = substring(strBaseUnitOfMeasure,1,iBaseUnitOfMeasureEndCode);
			strBaseUnitOfMeasureSAP = strBaseUnitOfMeasure;
		}
	}

	// 06DN0661-BaseUnitOfMeasure - BUnit
	var strBaseUnitOfMeasureBUnitSAP="";
	var strBaseUnitOfMeasureBUnit="";
	var oBaseUnitOfMeasureBUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oBUnitItem,"06DN0661-BaseUnitOfMeasure");
	if(oBaseUnitOfMeasureBUnitEn!=null) {
		strBaseUnitOfMeasureBUnit = checkString(oBaseUnitOfMeasureBUnitEn[0].getEntryNodeValue(),"");
		if(strBaseUnitOfMeasureBUnit!="") {
			strBaseUnitOfMeasureBUnitSAP = strBaseUnitOfMeasureBUnit;
		}
	}
	
	// Retrieve BaseUnitOfMesure code from L210
	var strBaseUnitOfMeasureL210="";
	var oL210Lkp = getCtgByName("L210-Unités normées - normalized units");
	var oL210LkpItemSet = oL210Lkp.getItemSetForCatalog();
	forEachItemSetElement(oL210LkpItemSet,oL210LkpItem) {
		var strSAPCode = oL210LkpItem.getEntryAttrib("SL210-normalized_units/C05-Code SAP");
		if(strSAPCode==strBaseUnitOfMeasureSAP) {
			strBaseUnitOfMeasureL210=oL210LkpItem.getEntryAttrib("SL210-normalized_units/C00-DisplayName");
		}
	}

	// SupportOfPacking
	var strSupportOfPacking = "";
	var strSupportOfPackingSAP = "";
	var oSupportOfPackingEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oChildItem2,"06DN0399-SupportOfPacking");
	if (oSupportOfPackingEn!=null) {
		strSupportOfPacking = checkString(oSupportOfPackingEn.getEntryNodeValue(),"");
		if(strSupportOfPacking!="") {
			var lkp195 = getCtgByName("L195-Type d emballage - Packing type");
			var olkpitem = lkp195.getEntryByPrimaryKey(strSupportOfPacking);
			if(olkpitem!=null) {
				strSupportOfPackingSAP=olkpitem.getEntryAttrib("SL195-Packing_type/C06-SAP Code");
			}
		}
	}
	
	// SupportOfPacking - BUnit
	var strSupportOfPackingBUnit = "";
	var strSupportOfPackingBUnitSAP = "";
	var oSupportOfPackingBUnitEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oBUnitItem,"06DN0399-SupportOfPacking");
	if (oSupportOfPackingBUnitEn!=null) {
		strSupportOfPackingBUnit = checkString(oSupportOfPackingBUnitEn.getEntryNodeValue(),"");
		if(strSupportOfPackingBUnit!="") {
			var lkp195 = getCtgByName("L195-Type d emballage - Packing type");
			var olkpitem = lkp195.getEntryByPrimaryKey(strSupportOfPackingBUnit);
			if(olkpitem!=null) {
				strSupportOfPackingBUnitSAP=olkpitem.getEntryAttrib("SL195-Packing_type/C06-SAP Code");
			}
		}
	}
	
	// SupportOfPacking - PItem 1
	var strSupportOfPackingPItem1 = "";
	var strSupportOfPackingPItem1SAP = "";
	var oSupportOfPackingPItem1En = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oPItem1Item,"06DN0399-SupportOfPacking");
	if (oSupportOfPackingPItem1En!=null) {
		strSupportOfPackingPItem1= checkString(oSupportOfPackingPItem1En.getEntryNodeValue(),"");
		if(strSupportOfPackingPItem1!="") {
			var lkp195 = getCtgByName("L195-Type d emballage - Packing type");
			var olkpitem = lkp195.getEntryByPrimaryKey(strSupportOfPackingPItem1);
			if(olkpitem!=null) {
				strSupportOfPackingPItem1SAP=olkpitem.getEntryAttrib("SL195-Packing_type/C06-SAP Code");
			}
		}
	}
	
	var iDigitsHM="0";
	var strDigitsTypeHM="";
	var bDigitsUnitTypeHM=false;
	var iDigitsTO="0";
	var strDigitsTypeTO="";
	var bDigitsUnitTypeTO=false;
	
	//
	var strChildItemType2 = getScriptByPath("/scripts/triggers/LG.Business.Initial.Rules").getFunctionByName("getItemType").invoke(oChildItem2,hmGlobals);
	if (strChildItemType2!=null && strChildItemType2!=""){
		var oNumberofPackagedItemsEn2 = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oChildItem2,"06DN0402-NumberOfPackagedItems");
		if(oNumberofPackagedItemsEn2!=null) {
			var iNumberofPackagedItemslevel2Init = oNumberofPackagedItemsEn2[0].getEntryNodeValue();
			if(iNumberofPackagedItemslevel2Init!=null) {
				strChildItemType2 = strChildItemType2.replaceString(" ","");
				var strItemType3 = substring(strChildItemType2,2,strChildItemType2.length());
				var strUnitKheopsAttribute = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getBaseUnitAttrNameFromL906").invoke(strCatalogCode,"Bunit",oBUnitItem,hmGlobals);
				var unittypesTemp2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getUnitsFromCurrentItemType").invoke(strCatalogCode,strItemType3,oChildItem2,hmGlobals);
				if (unittypesTemp2!=null) {
					var unittypes2 = getScriptByPath("/scripts/triggers/LG.Library.Utils").getFunctionByName("getDeduplicatedArray").invoke(unittypesTemp2);										
					unittypesTemp2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("deleteBaseUnitOfMesureFromUnitList").invoke(unittypesTemp2,strBaseUnitOfMeasureSAP);
					//
					var strEANCode = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCode").invoke(oBUnitItem,strTradeItemOrderable);
					var strEANCategory = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCategory").invoke(oBUnitItem,strEANCode);
					
					// Poids brut caractéristiques physiques
					var poidsBrut04CPArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsBrut04CP").invoke(oBUnitItem);
					var poids04CPDoubleBUnit = poidsBrut04CPArrayBUnit["kg"];
					
					// Largeur Prod
					var largeurArrayProd = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLargeur").invoke(oProdItem);
					var largeurDoubleBUnit = largeurArrayProd["m"];
					var largeurDoublehectomProd = largeurArrayProd["hm"];
					var largeurDoublemillimProd = largeurArrayProd["mm"];

					// Largeur
					var largeurArrayBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLargeur").invoke(oBUnitItem);
					var largeurDoubleBUnit = largeurArrayBUnit["m"];
					var largeurDoublehectomBUnit= largeurArrayBUnit["hm"];
					var largeurDoublemillimBUnit= largeurArrayBUnit["mm"];	

					var strLargeur;
					if(largeurDoublemillimBUnit!=null && largeurDoublemillimBUnit>0) {
						strLargeur = largeurDoublemillimBUnit;
					}
					if(largeurDoublemillimProd!=null && largeurDoublemillimProd>0) {
						strLargeur = largeurDoublemillimProd;
					}
					if(strLargeur==null) {
						strLargeur="";
					}

					// RealThickness
					var oItemProd = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getParentItem").invoke(hmGlobals,oBUnitItem);
					var realThicknessProd = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getRealThicknessProd").invoke(oItemProd);
					var realThicknessDoubleProd = realThicknessProd["mm"];
					
					// Thickness
					var thicknessBUnit = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getThicknessBUnit").invoke(oBUnitItem);
					var thicknessDoubleBUnit = thicknessBUnit["mm"];

					var strThickness;
					if(realThicknessDoubleProd!=null && realThicknessDoubleProd>0) {
						strThickness = realThicknessDoubleProd;
					}
					if(thicknessDoubleBUnit!=null && thicknessDoubleBUnit>0) {
						strThickness = thicknessDoubleBUnit;
					}
					if(strThickness==null) {
						strThickness="";
					}
					
					//
					var strEANCodePItem2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCode").invoke(oChildItem2,strTradeItemOrderable);
					var strEANCategoryPItem2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCategory").invoke(oChildItem2,strEANCodePItem2);
					
					// Poids brut caractéristiques physiques
					var poidsBrut04CPArrayPItem2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsBrut04CP").invoke(oChildItem2);
					var poids04CPDoublePItem2 = poidsBrut04CPArrayPItem2["kg"];

					// Largeur
					var largeurArrayPItem2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLargeurPItem").invoke(oChildItem2);
					var largeurDoublePItem2 = largeurArrayPItem2["m"];
					var largeurDoublehectomPItem2= largeurArrayPItem2["hm"];
					var largeurDoublemillimPItem2= largeurArrayPItem2["mm"];	
					
					// Thickness
					var thicknessPItem2 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getThicknessPItem").invoke(oChildItem2);
					var thicknessDoublePItem2 = thicknessPItem2["mm"];
					//
					var strEANCodePItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCode").invoke(oPItem1Item,strTradeItemOrderable);
					var strEANCategoryPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getEANCategory").invoke(oPItem1Item,strEANCodePItem1);
					
					// Poids brut caractéristiques physiques
					var poidsBrut04CPArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsBrut04CP").invoke(oPItem1Item);
					var poids04CPDoublePItem1 = poidsBrut04CPArrayPItem1["kg"];

					// Largeur
					var largeurArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLargeurPItem").invoke(oPItem1Item);
					var largeurDoublemillimPItem1= largeurArrayPItem1["mm"];	
					
					// Longueur
					var longueurArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getLongueurPItem").invoke(oPItem1Item);
					var longueurDoublemillimPItem1= longueurArrayPItem1["mm"];
					
					// Thickness
					var thicknessPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getThicknessPItem").invoke(oPItem1Item);
					var thicknessDoublePItem1 = thicknessPItem1["mm"];

					// Volume
					var volumeArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getVolume").invoke(oPItem1Item);
					var volumeDoublePItem1 = volumeArrayPItem1["m3"];

					// Poids net
					var poidsNetArrayPItem1 = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("getPoidsNet").invoke(oPItem1Item);
					var poidsNetDoublePItem1 = poidsNetArrayPItem1["kg"];
					//
					var iMulti = "1";
					var strSAPUnitType2 = strBaseUnitOfMeasureSAP;
					
					if(
					(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
					(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
					(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2!=strSupportOfPackingPItem1SAP && strSAPUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
					(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
					(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
					(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
					(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2!=strSupportOfPackingPItem1SAP && strSAPUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
					(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
					(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
					){
						if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
							if(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP){
								var aConvTemp = getConvArray(strMATNRPitem2,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,strEANCodePItem2,strEANCategoryPItem2,poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
								aConvPItem2.add(aConvTemp);
							}
							else if((strSAPUnitType2==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK2 || strULRef2==strChildItemPK2)) && strCatalogCode=="C120") {
								var aConvTemp = getConvArray(strMATNRPitem2,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,strEANCode,strEANCategory,poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
								aConvPItem2.add(aConvTemp);
							}
							else {
								var aConvTemp = getConvArray(strMATNRPitem2,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
								aConvPItem2.add(aConvTemp);
							}
						}
						//
						unittypes2=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("removeValueFromArray").invoke(unittypes2,strBaseUnitOfMeasureSAP);
					}
					else if(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
						if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
							if((strSAPUnitType2==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK2 || strULRef2==strChildItemPK2)) && strCatalogCode=="C120") {
								var aConvTemp = getConvArray(strMATNRPitem2,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,strEANCode,strEANCategory,poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
								aConvPItem2.add(aConvTemp);	
							}
							else {
								var aConvTemp = getConvArray(strMATNRPitem2,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
								aConvPItem2.add(aConvTemp);	
							}
						}
						//
						unittypes2=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("removeValueFromArray").invoke(unittypes2,strBaseUnitOfMeasureSAP);										
					}
					else if(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
						if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
							if((strSAPUnitType2==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK2 || strULRef2==strChildItemPK2)) && (strCatalogCode=="C120" || strCatalogCode=="C025")) {
								var aConvTemp = getConvArray(strMATNRPitem2,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,strEANCode,strEANCategory,poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvPItem2.add(aConvTemp);	
							
							} else {
								var aConvTemp = getConvArray(strMATNRPitem2,"1",strBaseUnitOfMeasureSAP,"1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
								aConvPItem2.add(aConvTemp);	
							}
						}
						//
						unittypes2=getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("removeValueFromArray").invoke(unittypes2,strBaseUnitOfMeasureSAP);	
					}
					//
					unittypes2 = sortUnits(unittypes2);
					//
					// Other conversions
					for (var j=0;j<unittypes2.size(); j++) {
						var strUnitType2 = unittypes2[j];
						//
						var iNumberofPackagedItemslevel2 = iNumberofPackagedItemslevel2Init;
						//
						if (strUnitType2=="PAL") {
							var iMulti = "1";
							var multiNumber2=1;
							//
							var strSAPUnitType2 = "PAL";
							if(
							(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
							(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
							(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2!=strSupportOfPackingPItem1SAP && strSAPUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
							(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
							(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
							(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
							(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2!=strSupportOfPackingPItem1SAP && strSAPUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
							(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
							(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
							){
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									if(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP){
										var aConvTemp = getConvArray(strMATNRPitem2,multiNumber2,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,strEANCodePItem2,strEANCategoryPItem2,poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);
									}
									else if((strSAPUnitType2==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK2 || strULRef2==strChildItemPK2)) && strCatalogCode=="C120") {
										var aConvTemp = getConvArray(strMATNRPitem2,multiNumber2,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,strEANCode,strEANCategory,poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);									
									}
									else {
										var aConvTemp = getConvArray(strMATNRPitem2,multiNumber2,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);
									}
								}
							}
							else if(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									if((strSAPUnitType2==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK2 || strULRef2==strChildItemPK2)) && strCatalogCode=="C120") {
										var aConvTemp = getConvArray(strMATNRPitem2,multiNumber2,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,strEANCode,strEANCategory,poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem2.add(aConvTemp);									
									}
									else {
										var aConvTemp = getConvArray(strMATNRPitem2,multiNumber2,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem2.add(aConvTemp);
									}
								}
							}
							else if(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									if((strSAPUnitType2==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK2 || strULRef2==strChildItemPK2)) && strCatalogCode=="C120") {
										var aConvTemp = getConvArray(strMATNRPitem2,multiNumber2,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,strEANCode,strEANCategory,poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem2.add(aConvTemp);
									}
									else {
										var aConvTemp = getConvArray(strMATNRPitem2,multiNumber2,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem2.add(aConvTemp);									
									}
								}
							}
							else {
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									var aConvTemp = getConvArray(strMATNRPitem2,multiNumber2,strSAPUnitType2,iNumberofPackagedItemslevel2,"","","","","","","","",iMulti);		
									aConvPItem2.add(aConvTemp);
								}
							}
						}
						else if (strUnitType2=="ST" || strUnitType2=="BAG" || strUnitType2=="BOX" || strUnitType2=="PAK" || strUnitType2=="KAR" || strUnitType2=="GB" || strUnitType2=="BGE") {
							var strSAPUnitType2 = "";
							//
							if (strUnitType2=="GB") {
								strSAPUnitType2 = "GB";
							}
							else if (strUnitType2=="BOX") {
								strSAPUnitType2 = "BOX";
							}
							else if (strUnitType2=="KAR") {
								strSAPUnitType2 = "KAR";
							}
							else if (strUnitType2=="PAK") {
								strSAPUnitType2 = "PAK";
							}
							else if (strUnitType2=="ST") {
								strSAPUnitType2 = "ST";
							}
							else if (strUnitType2=="BAG") {
								strSAPUnitType2 = "BAG";
							}
							else if (strUnitType2=="BGE") {
								strSAPUnitType2 = "BGE";
							}
							var iQuantityOfNextLowerLevel;
							var multiNumber3;
							var oQuantityOfNextLowerLevelEn = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oChildItem2,"06DN0405-quantityOfNextLowerLevel");
							if(oQuantityOfNextLowerLevelEn!=null) {
								var iMulti = "1";
								var iQuantityOfNextLowerLevel = oQuantityOfNextLowerLevelEn[0].getEntryNodeValue();
								if (iQuantityOfNextLowerLevel!=null && iQuantityOfNextLowerLevel>0) {
									// multiNumber3 = iNumberofPackagedItemslevel2/iQuantityOfNextLowerLevel;
									multiNumber3 = iQuantityOfNextLowerLevel;
									//
									if(
									(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2!=strSupportOfPackingPItem1SAP && strSAPUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strSAPUnitType2!=strSupportOfPackingPItem1SAP && strSAPUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
											if(strSAPUnitType2!=strBaseUnitOfMeasureSAP && strSAPUnitType2==strSupportOfPackingSAP){
												var aConvTemp = getConvArray(strMATNRPitem2,multiNumber3,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,strEANCodePItem2,strEANCategoryPItem2,poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
												aConvPItem2.add(aConvTemp);
											}
											else if((strSAPUnitType2==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK2 || strULRef2==strChildItemPK2)) && strCatalogCode=="C120") {
												var aConvTemp = getConvArray(strMATNRPitem2,multiNumber3,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,strEANCode,strEANCategory,poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
												aConvPItem2.add(aConvTemp);
											}
											else {
												var aConvTemp = getConvArray(strMATNRPitem2,multiNumber3,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
												aConvPItem2.add(aConvTemp);
											}
										}
									}
									else if(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
										if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
											if((strSAPUnitType2==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK2 || strULRef2==strChildItemPK2)) && strCatalogCode=="C120") {
												var aConvTemp = getConvArray(strMATNRPitem2,multiNumber3,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,strEANCode,strEANCategory,poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem2.add(aConvTemp);
											}
											else {
												var aConvTemp = getConvArray(strMATNRPitem2,multiNumber3,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem2.add(aConvTemp);
											}
										}
									}
									else if(strSAPUnitType2==strBaseUnitOfMeasureSAP && strSAPUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
											if((strSAPUnitType2==strBaseUnitOfMeasureSAP && (strULRef1==strChildItemPK2 || strULRef2==strChildItemPK2)) && strCatalogCode=="C120") {
												var aConvTemp = getConvArray(strMATNRPitem2,multiNumber3,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,strEANCode,strEANCategory,poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem2.add(aConvTemp);	
											}
											else {
												var aConvTemp = getConvArray(strMATNRPitem2,multiNumber3,strSAPUnitType2,iNumberofPackagedItemslevel2,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem2.add(aConvTemp);	
											}
										}
									}
									else {
										if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
											if(strSAPUnitType2=="ST") {
												var aConvTemp = getConvArray(strMATNRPitem2,iNumberofPackagedItemslevel2,strSAPUnitType2,iNumberofPackagedItemslevel2,"","","","","","","","",iMulti);
												aConvPItem2.add(aConvTemp);
											} else {
												var aConvTemp = getConvArray(strMATNRPitem2,multiNumber3,strSAPUnitType2,iNumberofPackagedItemslevel2,"","","","","","","","",iMulti);		
												aConvPItem2.add(aConvTemp);
											}
										}
									}
								}
							}
						}
						else if (strUnitType2=="M2") {
							var aM2Conv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(surfaceDoubleBUnit,iNumberofPackagedItemslevel2);
							var strM2Conv = checkString(aM2Conv["UnitValueConv"],"");
							var iM2Coef = checkString(aM2Conv["Coef"],"");
							var iMulti = checkString(aM2Conv["Multi"],"");
							//
							if(strM2Conv!="" && iM2Coef!="") {
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									if(
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem2,strM2Conv,"M2",iM2Coef,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);
									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,strM2Conv,"M2",iM2Coef,poids04CPDoublePItem2,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,strM2Conv,"M2",iM2Coef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem2.add(aConvTemp);
									}
								}
							}
						}
						else if (strUnitType2=="M") {
							var aMConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(longueurDoubleBUnit,iNumberofPackagedItemslevel2);
							var strMConv = checkString(aMConv["UnitValueConv"],"");
							var iMCoef = checkString(aMConv["Coef"],"");
							var iMulti = checkString(aMConv["Multi"],"");
							//
							if(iDigitsHM!="0" && strDigitsTypeHM=="UMREZ" && bDigitsUnitTypeHM==true) {
								if(iDigitsHM=="10" && strMConv.length()>1) {
									var iValTemp2 = toInteger(substring(strMConv,(strMConv.length()-1),(strMConv.length())));
									strMConv=substring(strMConv,0,(strMConv.length()-1));
									var iValTemp1 = toInteger(strMConv);
									if(iValTemp2>5) {
										iValTemp1=iValTemp1+1;
									}
									strMConv=iValTemp1+"0";
								}
								else if(iDigitsHM=="100" && strMConv.length()>10) {
									var iValTemp2 = toInteger(substring(strMConv,(strMConv.length()-2),(strMConv.length())));
									strMConv=substring(strMConv,0,(strMConv.length()-2));
									var iValTemp1 = toInteger(strMConv);
									if(iValTemp2>50) {
										iValTemp1=iValTemp1+1;
									}
									strMConv=iValTemp1+"00";
								}
								else if(iDigitsHM=="1000" && strMConv.length()>100) {
									var iValTemp2 = toInteger(substring(strMConv,(strMConv.length()-3),(strMConv.length())));
									strMConv=substring(strMConv,0,(strMConv.length()-3));
									var iValTemp1 = toInteger(strMConv);
									if(iValTemp2>500) {
										iValTemp1=iValTemp1+1;
									}
									strMConv=iValTemp1+"000";
								}								
							}
							//
							if(strMConv!="" && iMCoef!="") {
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									if(
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem2,strMConv,"M",iMCoef,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,strMConv,"M",iMCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,strMConv,"M",iMCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem2.add(aConvTemp);
									}
								}
							}
						}
						else if (strUnitType2=="HM") {
							var aHMConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(longueurDoublehectomBUnit,iNumberofPackagedItemslevel2);
							var strHMConv = checkString(aHMConv["UnitValueConv"],"");
							var iHMCoef = checkString(aHMConv["Coef"],"");
							var iMulti = checkString(aHMConv["Multi"],"");
							iDigitsHM = checkString(aHMConv["Digits"],"");
							strDigitsTypeHM = checkString(aHMConv["DigitsType"],"");
							bDigitsUnitTypeHM=true;
							//
							if(strHMConv!="" && iHMCoef!="") {
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									if(
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem2,strHMConv,"HM",iHMCoef,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,strHMConv,"HM",iHMCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,strHMConv,"HM",iHMCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem2.add(aConvTemp);
									}
								}
							}
						}
						else if (strUnitType2=="KG") {
							if (strUnitKheopsAttribute=="TO") {
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									var iMulti = "1";
									if(
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","KG","1",poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","KG","1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","KG","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem2.add(aConvTemp);
									}
								}
							} 
							else {
								// ****************************
								// Ajout nouvelle règle de gestion (si le poids est dispo depuis l'attribut 04CP0213-netWeight ou l'attribut 06DN0360-GrossWeight
								// ****************************
								var aKGConv;
								if (poidsNetDoublePItem2!=null && poidsNetDoublePItem2>0) {
									aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsNetDoublePItem2,iNumberofPackagedItemslevel2);
								}
								else {
									if(poidsDoublePItem2!=null && poidsDoublePItem2>0) {
										aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsDoublePItem2,iNumberofPackagedItemslevel2);
									}
									else {
										if (poidsNetDoubleBUnit!=null && poidsNetDoubleBUnit>0) {
											aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsNetDoubleBUnit,iNumberofPackagedItemslevel2);
										}
										else {
											if(poidsDoubleBUnit!=null && poidsDoubleBUnit>0) {
												aKGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsDoubleBUnit,iNumberofPackagedItemslevel2);
											}
										}
									}
								}
								if(aKGConv!=null) {
									var strKGConv = checkString(aKGConv["UnitValueConv"],"");
									var iKGCoef = checkString(aKGConv["Coef"],"");
									var iMulti = checkString(aKGConv["Multi"],"");
									//
									if(iDigitsTO!="0" && strDigitsTypeTO=="UMREZ" && bDigitsUnitTypeTO==true) {
										if(iDigitsTO=="10" && strKGConv.length()>1) {
											var iValTemp2 = toInteger(substring(strKGConv,(strKGConv.length()-1),(strKGConv.length())));
											strKGConv=substring(strKGConv,0,(strKGConv.length()-1));
											var iValTemp1 = toInteger(strKGConv);
											if(iValTemp2>5) {
												iValTemp1=iValTemp1+1;
											}
											strKGConv=iValTemp1+"0";
										}
										else if(iDigitsTO=="100" && strKGConv.length()>10) {
											var iValTemp2 = toInteger(substring(strKGConv,(strKGConv.length()-2),(strKGConv.length())));
											strKGConv=substring(strKGConv,0,(strKGConv.length()-2));
											var iValTemp1 = toInteger(strKGConv);
											if(iValTemp2>50) {
												iValTemp1=iValTemp1+1;
											}
											strKGConv=iValTemp1+"00";
										}
										else if(iDigitsTO=="1000" && strKGConv.length()>100) {
											var iValTemp2 = toInteger(substring(strKGConv,(strKGConv.length()-3),(strKGConv.length())));
											strKGConv=substring(strKGConv,0,(strKGConv.length()-3));
											var iValTemp1 = toInteger(strKGConv);
											if(iValTemp2>500) {
												iValTemp1=iValTemp1+1;
											}
											strKGConv=iValTemp1+"000";
										}								
									}
									//
									if(strKGConv!="" && iKGCoef!="") {
										if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
											if(
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
											){
												var aConvTemp = getConvArray(strMATNRPitem2,strKGConv,"KG",iKGCoef,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
												aConvPItem2.add(aConvTemp);

											}
											else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem2,strKGConv,"KG",iKGCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem2.add(aConvTemp);

											}
											else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem2,strKGConv,"KG",iKGCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem2.add(aConvTemp);
											}
										}
									}
								}
							}
						}
						else if (strUnitType2=="L") {
							if (strUnitKheopsAttribute=="M3") {
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									var iMulti = "1";
									if(
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","L","1",poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","L","1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","L","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem2.add(aConvTemp);
									}
								}
							} 
							else {
								if(volumeDoublelitrePItem2!=null && volumeDoublelitrePItem2>0) {
									aLConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(volumeDoublelitrePItem2,iNumberofPackagedItemslevel2);
								}
								else {
									if (volumeDoublelitreBUnit!=null && volumeDoublelitreBUnit>0) {
										aLConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(volumeDoublelitreBUnit,iNumberofPackagedItemslevel2);
									}
								}
								//
								if(aLConv!=null) {
									var strLConv = checkString(aLConv["UnitValueConv"],"");
									var iLCoef = checkString(aLConv["Coef"],"");
									var iMulti = checkString(aLConv["Multi"],"");
									//
									if(strLConv!="" && iLCoef!="") {
										if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
											if(
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
											){
												var aConvTemp = getConvArray(strMATNRPitem2,strLConv,"L",iLCoef,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
												aConvPItem2.add(aConvTemp);

											}
											else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem2,strLConv,"L",iLCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem2.add(aConvTemp);

											}
											else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem2,strLConv,"L",iLCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem2.add(aConvTemp);
											}
										}
									}
								}
							}
						}
						else if (strUnitType2=="ML") {
							if (strUnitKheopsAttribute=="L") {
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									var iMulti = "1";
									if(
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","ML","1",poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","ML","1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","ML","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem2.add(aConvTemp);
									}
								}
							} 
							else {
								if(volumeDoublemillilitrePItem2!=null && volumeDoublemillilitrePItem2>0) {
									aMLConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(volumeDoublemillilitrePItem2,iNumberofPackagedItemslevel2);
								}
								else {
									if (volumeDoublemillilitreBUnit!=null && volumeDoublemillilitreBUnit>0) {
										aMLConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(volumeDoublemillilitreBUnit,iNumberofPackagedItemslevel2);
									}
								}
								//
								if(aMLConv!=null) {
									var strMLConv = checkString(aMLConv["UnitValueConv"],"");
									var iMLCoef = checkString(aMLConv["Coef"],"");
									var iMulti = checkString(aMLConv["Multi"],"");
									//
									if(strMLConv!="" && iMLCoef!="") {
										if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
											if(
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
											){
												var aConvTemp = getConvArray(strMATNRPitem2,strMLConv,"ML",iMLCoef,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
												aConvPItem2.add(aConvTemp);

											}
											else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem2,strMLConv,"ML",iMLCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem2.add(aConvTemp);

											}
											else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem2,strMLConv,"ML",iMLCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem2.add(aConvTemp);
											}
										}
									}
								}
							}
						}
						else if (strUnitType2=="TO") {
							if (strUnitKheopsAttribute=="KG") {
								var iMulti = "1000";
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									if(
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem2,"1","TO","1000",poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,"1","TO","1000",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,"1","TO","1000",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem2.add(aConvTemp);
									}
								}
							} 
							else {
								// ****************************
								// Ajout nouvelle règle de gestion (si le poids est dispo depuis l'attribut 04CP0213-netWeight ou l'attribut 06DN0360-GrossWeight
								// ****************************
								var aTOConv;
								if (poidsNetDoubletonnePItem2!=null && poidsNetDoubletonnePItem2>0) {
									aTOConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsNetDoubletonnePItem2,iNumberofPackagedItemslevel2);
								}
								else {
									if(poidsDoubletonnePItem2!=null && poidsDoubletonnePItem2>0) {
										aTOConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsDoubletonnePItem2,iNumberofPackagedItemslevel2);
									}
									else {
										if (poidsNetDoubletonneBUnit!=null && poidsNetDoubletonneBUnit>0) {
											aTOConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsNetDoubletonneBUnit,iNumberofPackagedItemslevel2);
										}
										else {
											if(poidsDoubletonneBUnit!=null && poidsDoubletonneBUnit>0) {
												aTOConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsDoubletonneBUnit,iNumberofPackagedItemslevel2);
											}
										}
									}
								}
								if(aTOConv!=null) {
									var strTOConv = checkString(aTOConv["UnitValueConv"],"");
									var iTOCoef = checkString(aTOConv["Coef"],"");
									var iMulti = checkString(aTOConv["Multi"],"");
									iDigitsTO = checkString(aTOConv["Digits"],"");
									strDigitsTypeTO = checkString(aTOConv["DigitsType"],"");
									bDigitsUnitTypeTO=true;
									//
									if(strTOConv!="" && iTOCoef!="") {
										if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
											if(
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
											){
												var aConvTemp = getConvArray(strMATNRPitem2,strTOConv,"TO",iTOCoef,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
												aConvPItem2.add(aConvTemp);

											}
											else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem2,strTOConv,"TO",iTOCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem2.add(aConvTemp);

											}
											else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem2,strTOConv,"TO",iTOCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem2.add(aConvTemp);
											}
										}
									}
								}
							}
						}
						else if (strUnitType2=="G") {
							if (strUnitKheopsAttribute=="KG") {
								if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
									var iMulti = "1";
									if(
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
									(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
									){
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","G","1",poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","G","1",poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
										aConvPItem2.add(aConvTemp);

									}
									else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
										var aConvTemp = getConvArray(strMATNRPitem2,"1000","G","1",poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
										aConvPItem2.add(aConvTemp);
									}
								}
							} 
							else {
								// ****************************
								// Ajout nouvelle règle de gestion (si le poids est dispo depuis l'attribut 04CP0213-netWeight ou l'attribut 06DN0360-GrossWeight
								// ****************************
								var aGConv;
								if (poidsNetDoublegrammePItem2!=null && poidsNetDoublegrammePItem2>0) {
									aGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsNetDoublegrammePItem2,iNumberofPackagedItemslevel2);
								}
								else {
									if(poidsDoubletonnePItem2!=null && poidsDoubletonnePItem2>0) {
										aGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(poidsDoublegrammePItem2,iNumberofPackagedItemslevel2);
									}
									else {
										if (poidsNetDoublegrammeBUnit!=null && poidsNetDoublegrammeBUnit>0) {
											aGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsNetDoublegrammeBUnit,iNumberofPackagedItemslevel2);
										}
										else {
											if(poidsDoublegrammeBUnit!=null && poidsDoublegrammeBUnit>0) {
												aGConv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(poidsDoublegrammeBUnit,iNumberofPackagedItemslevel2);
											}
										}
									}
								}
								if(aGConv!=null) {
									var strGConv = checkString(aGConv["UnitValueConv"],"");
									var iGCoef = checkString(aGConv["Coef"],"");
									var iMulti = checkString(aGConv["Multi"],"");
									//
									if(strGConv!="" && iGCoef!="") {
										if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
											if(
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
											(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
											(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
											){
												var aConvTemp = getConvArray(strMATNRPitem2,strGConv,"G",iGCoef,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
												aConvPItem2.add(aConvTemp);

											}
											else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem2,strGConv,"G",iGCoef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
												aConvPItem2.add(aConvTemp);

											}
											else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
												var aConvTemp = getConvArray(strMATNRPitem2,strGConv,"G",iGCoef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
												aConvPItem2.add(aConvTemp);
											}
										}
									}
								}
							}
						}
						else if (strUnitType2=="M3") {
							var aM3Conv;
							if(volumeDoublePItem2!=null && volumeDoublePItem2>0) {
								aM3Conv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValueForPItem").invoke(volumeDoublePItem2,iNumberofPackagedItemslevel2);
							}
							else {
								aM3Conv = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("retrieveUnitValue").invoke(volumeDoubleBUnit,iNumberofPackagedItemslevel2);
							}
							if(aM3Conv!=null) {
								var strM3Conv = checkString(aM3Conv["UnitValueConv"],"");
								var iM3Coef = checkString(aM3Conv["Coef"],"");
								var iMulti = checkString(aM3Conv["Multi"],"");
								//
								if(strM3Conv!="" && iM3Coef!="") {
									if (strTradeItemOrderable=="true" || bPItem2Relevance=="true" || bInactiveItemToProcess=="true") {
										if(
										(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
										(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
										(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) ||
										(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) || 
										(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) || 
										(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2==strSupportOfPackingPItem1SAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
										(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strUnitType2!=strSupportOfPackingPItem1SAP && strUnitType2!=strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
										(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) ||
										(strUnitType2!=strBaseUnitOfMeasureSAP && strUnitType2==strSupportOfPackingBUnitSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP)
										){
											var aConvTemp = getConvArray(strMATNRPitem2,strM3Conv,"M3",iM3Coef,poids04CPDoublePItem2,longueurDoublemillimPItem2,largeurDoublemillimPItem2,thicknessDoublePItem2,"","",poidsNetDoublePItem2,volumeDoublePItem2,iMulti);
											aConvPItem2.add(aConvTemp);

										}
										else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP!=strSupportOfPackingBUnitSAP) {
											var aConvTemp = getConvArray(strMATNRPitem2,strM3Conv,"M3",iM3Coef,poids04CPDoublePItem1,longueurDoublemillimPItem1,largeurDoublemillimPItem1,thicknessDoublePItem1,"","",poidsNetDoublePItem1,volumeDoublePItem1,iMulti);
											aConvPItem2.add(aConvTemp);
										
										}
										else if(strUnitType2==strBaseUnitOfMeasureSAP && strUnitType2!=strSupportOfPackingSAP && strBaseUnitOfMeasureBUnitSAP==strSupportOfPackingBUnitSAP) {
											var aConvTemp = getConvArray(strMATNRPitem2,strM3Conv,"M3",iM3Coef,poids04CPDoubleBUnit,longueurDoublemillimBUnit,strLargeur,strThickness,"","",poidsNetDoubleBUnit,volumeDoubleBUnit,iMulti);
											aConvPItem2.add(aConvTemp);
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
	return aConvPItem2;
}

// *****************************************
// En création, on récupère le paramétrage depuis la table L906. En revanche, une fois l'ensemble initialisé, on se base sur les valeurs des attributs de l'item
// *****************************************
function applyConversions(oItem) {
	var log = getLogger("Lafarge.DataEntry");
	log.loggerDebug("ITEM Conversions " + oItem.getPrimaryKey());
	//
	var hmGlobals = getScriptByPath("/scripts/triggers/LG.Library.Actions").getFunctionByName("initGlobals").invoke();
	var strItemType = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getItemType").invoke(oItem);
	var convlist;
	//
	// log.loggerDebug("ITEM Conversions strItemType=" + strItemType);
	
	if(strItemType == "Prod") { 
		convlist = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("manageProdConversions").invoke(oItem,hmGlobals);
	}
	else if(strItemType == "BUnit") { 
		convlist = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("manageBUnitConversions").invoke(oItem,hmGlobals);
	}
	else if (strItemType == "PItem") { 
		var parentErpCode = oItem.getItemUsingEntryRelationshipAttrib(hmGlobals["PARENT_RELATIONSHIP_FIELD"]).getPrimaryKey(); 
		if (parentErpCode.contains("B")) {
			convlist = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("managePItem1Conversions").invoke(oItem,hmGlobals);
		}
		if (parentErpCode.contains("I")) {
			convlist = getScriptByPath("/scripts/triggers/LG.Library.SAP.Conversions").getFunctionByName("managePItem2Conversions").invoke(oItem,hmGlobals);
		}
	}

	var strCatalogCode = substring(replaceString(oItem.getCatalog().getCtgName(),"CA","C"),1,4);
	
	log.loggerDebug("DELETE PREVIOUS CONVERSIONS");
	
	// Delete all existing conversions
	var oConvEnList = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodesFromAttrPath").invoke(oItem,"AlternativeUnitGroup");
	if (oConvEnList!=null) {
		var oConvEnLen = oConvEnList.size();
		for(var m=0;m<oConvEnLen;m++) {
			var oConvEn = oConvEnList[m];
			oConvEn.deleteEntryNode();
		}
	}

	log.loggerDebug("ADD NEW CONVERSIONS");
	
	log.loggerDebug("convlist.size()="+convlist.size());
	
	// Add new conversions
	if (convlist!=null && convlist.size()>0) {
		var strSpecNamePath = getScriptByPath("/scripts/triggers/LG.Library.LGUtils").getFunctionByName("getEntryNodeFromAttrPath").invoke(oItem,"01AC0014-invoiceName").getEntryNodeExactPath();
		if(strSpecNamePath!=null && strSpecNamePath!="") {
			strSpecNamePath = substring(strSpecNamePath,1);
			strSpecNamePath = substring(strSpecNamePath,0,strSpecNamePath.indexOf("/"));
		}
		//
		var r=0;
		for(var m=0;m<convlist.size();m++) {
			var aConvTemp = convlist[m];
			//
			var strCounter = checkString(aConvTemp["UMREZ"],"");
			var strUOM = checkString(aConvTemp["MEINH"],"");
			var strDenominator = checkString(aConvTemp["UMREN"],"");
			//
			log.loggerDebug("strUOM="+strUOM);
			//
			var strThicknessOrHeight = checkString(aConvTemp["ThicknessOrHeight"],"");
			var strWidth = checkString(aConvTemp["Width"],"");
			var strLengthOrDepth = checkString(aConvTemp["LengthOrDepth"],"");
			var strNetWeight = checkString(aConvTemp["NetWeight"],"");
			var strGrossWeight = checkString(aConvTemp["GrossWeight"],"");
			var strGrossNetWeightUnit = checkString(aConvTemp["GrossNetWeightUnit"],"");
			var strGrossVolume = checkString(aConvTemp["GrossVolume"],"");
			var strGrossVolumeUnit = checkString(aConvTemp["GrossVolumeUnit"],"");
			var strGTIN = checkString(aConvTemp["GTIN"],"");
			var strEANCategory = checkString(aConvTemp["EANCategory"],"");
			var strDimensionsUnit = checkString(aConvTemp["DimensionsUnit"],"");
			//
			var strCounterExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0759-Counter");
			var strDenominatorExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0760-Denominator");
			var strAlternativeUnitExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0771-AlternativeUnit");
			//
			var strThicknessOrHeightExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0796-ThicknessOrHeight");
			var strWidthExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0797-Width");
 			var strLengthOrDepthExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0798-LengthOrDepth");
 			var strNetWeightExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0799-netWeight");
 			var strGrossWeightExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0800-grossWeight");
 			var strGrossNetWeightUnitExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0801-GrossNetWeightUnit");
 			var strGrossVolumeExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0802-GrossVolume");
 			var strGrossVolumeUnitExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0803-GrossVolumeUnit");
			var strGTINExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0804-GTIN");
			var strEANCategoryExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0805-EANCategory");
			var strDimensionsUnitExactPath = concat(strSpecNamePath,"/AlternativeUnitGroup#",r,"/06DN0806-DimensionsUnit");
			//
			if(strCounter!="" && strUOM!="" && strDenominator!="") {
				r++;
				oItem.setEntryAttrib(strCounterExactPath,strCounter);
				oItem.setEntryAttrib(strDenominatorExactPath,strDenominator); 
				oItem.setEntryAttrib(strAlternativeUnitExactPath,strUOM); 
				//
				if(strThicknessOrHeight!="" && (strCatalogCode!="200" && strCatalogCode!="205" && strCatalogCode!="210" && strCatalogCode!="215")) {
					oItem.setEntryAttrib(strThicknessOrHeightExactPath,strThicknessOrHeight); 
				}
				if(strWidth!="" && (strCatalogCode!="200" && strCatalogCode!="205" && strCatalogCode!="210" && strCatalogCode!="215")) {
					oItem.setEntryAttrib(strWidthExactPath,strWidth); 
				}
				if(strLengthOrDepth!="" && (strCatalogCode!="200" && strCatalogCode!="205" && strCatalogCode!="210" && strCatalogCode!="215")) {
					if(!(strItemType == "Prod" && strCatalogCode=="010")) {
						oItem.setEntryAttrib(strLengthOrDepthExactPath,strLengthOrDepth); 
					}
				}
				if(strNetWeight!="" && (strCatalogCode!="200" && strCatalogCode!="205" && strCatalogCode!="210" && strCatalogCode!="215")) {
					if(!(strItemType == "Prod" && strCatalogCode=="010")) {
						oItem.setEntryAttrib(strNetWeightExactPath,strNetWeight); 
					}
				}
				if(strGrossWeight!="" && (strCatalogCode!="200" && strCatalogCode!="205" && strCatalogCode!="210" && strCatalogCode!="215")) {
					if(!(strItemType == "Prod" && strCatalogCode=="010")) {
						oItem.setEntryAttrib(strGrossWeightExactPath,strGrossWeight); 
					}
				}
				if(strGrossWeight!="" && strGrossNetWeightUnit!="" && (strCatalogCode!="200" && strCatalogCode!="205" && strCatalogCode!="210" && strCatalogCode!="215")) {
					if(!(strItemType == "Prod" && strCatalogCode=="010")) {
						oItem.setEntryAttrib(strGrossNetWeightUnitExactPath,strGrossNetWeightUnit); 
					}
				}
				if(strGrossVolume!="" && (strCatalogCode!="200" && strCatalogCode!="205" && strCatalogCode!="210" && strCatalogCode!="215")) {
					if(!(strItemType == "Prod" && strCatalogCode=="010")) {
						oItem.setEntryAttrib(strGrossVolumeExactPath,strGrossVolume); 
					}
				}
				if(strGrossVolume!="" && strGrossVolumeUnit!="" && (strCatalogCode!="200" && strCatalogCode!="205" && strCatalogCode!="210" && strCatalogCode!="215")) {
					if(!(strItemType == "Prod" && strCatalogCode=="010")) {
						oItem.setEntryAttrib(strGrossVolumeUnitExactPath,strGrossVolumeUnit); 
					}
				}
				if(strGTIN!="") {
					oItem.setEntryAttrib(strGTINExactPath,strGTIN); 
				}				
				if(strEANCategory!="") {
					oItem.setEntryAttrib(strEANCategoryExactPath,strEANCategory); 
				}	
				if(((strThicknessOrHeight!="" || strWidth!="" || strLengthOrDepth!="") && strDimensionsUnit!="") && (strCatalogCode!="200" && strCatalogCode!="205" && strCatalogCode!="210" && strCatalogCode!="215")) {
					oItem.setEntryAttrib(strDimensionsUnitExactPath,strDimensionsUnit); 
				}	
			}
		}
	}
	log.loggerDebug("END CONVERSIONS");
}
